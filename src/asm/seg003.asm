; Generated by restunts-export.py (Ghidra)
.8086
.model medium

include seg003.inc

seg003 segment byte public use16 'STUNTSC'
    assume cs:seg003, es:nothing, ss:nothing, ds:dseg

    pop     ds
    retf

; void __cdecl16far sub_19F14(RECTANGLE * rect)
sub_19F14_asm_ proc far
    var_rectptr = word ptr   -2
    rect       = word ptr    6

    push    bp
    mov     bp, sp
    sub     sp, 0x4
    push    di
    push    si
    cmp     byte ptr [video_flag5_is0], 0x0
    jz      LAB_19f1_0016
    jmp     near ptr LAB_19f1_0180
LAB_19f1_0016:
    call    far ptr sprite_copy_2_to_1_2
    cmp     byte ptr [byte_454A4], 0x0
    jz      LAB_19f1_0025
    jmp     near ptr LAB_19f1_0136
LAB_19f1_0025:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_002f
    jmp     near ptr LAB_19f1_0120
LAB_19f1_002f:
    sub     si, si
LAB_19f1_0031:
    mov     byte ptr [si+rect_array_unk_indices], 0x3
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_0031
    cmp     byte ptr [detail_level], 0x4
    jnz     LAB_19f1_0049
    mov     ax, word ptr [word_463D6]
    mov     word ptr [word_449FE], ax
LAB_19f1_0049:
    mov     ax, word ptr [word_463D6]
    cmp     word ptr [word_449FE], ax
    jnz     LAB_19f1_007b
    mov     ax, word ptr [(rect_array_unk2+5*8).rc_left]
    cmp     word ptr [(rect_array_unk+5*8).rc_left], ax
    jnz     LAB_19f1_007b
    mov     ax, word ptr [(rect_array_unk2+5*8).rc_right]
    cmp     word ptr [(rect_array_unk+5*8).rc_right], ax
    jnz     LAB_19f1_007b
    mov     ax, word ptr [(rect_array_unk2+5*8).rc_top]
    cmp     word ptr [(rect_array_unk+5*8).rc_top], ax
    jnz     LAB_19f1_007b
    mov     ax, word ptr [(rect_array_unk2+5*8).rc_bottom]
    cmp     word ptr [(rect_array_unk+5*8).rc_bottom], ax
    jnz     LAB_19f1_007b
    mov     byte ptr [(rect_array_unk_indices+5)], 0x0
LAB_19f1_007b:
    mov     byte ptr [rect_array_unk3_length], 0x0
    mov     ax, offset rect_array_unk3
    push    ax
    mov     ax, offset rect_array_unk3_length
    push    ax
    push    word ptr [bp+rect]
    mov     ax, offset rect_array_unk2
    push    ax
    mov     ax, offset rect_array_unk
    push    ax
    mov     ax, offset rect_array_unk_indices
    push    ax
    mov     ax, 0xf                            ; number of rects in the array
    push    ax
    call    far ptr rectlist_add_rects
    add     sp, 0xe
    cmp     byte ptr [rect_array_unk3_length], 0x0
    jz      LAB_19f1_010e
    mov     ax, offset rect_array_unk3_indices
    push    ax
    mov     ax, offset rect_array_unk3
    push    ax
    mov     al, byte ptr [rect_array_unk3_length]
    cbw
    push    ax
    call    far ptr rect_array_sort_by_top
    add     sp, 0x6
    call    far ptr mouse_draw_opaque_check
    sub     si, si
    jmp     LAB_19f1_0103
LAB_19f1_00c8:
    mov     bx, si
    shl     bx, 0x1
    mov     ax, word ptr [bx+rect_array_unk3_indices]
    mov     cl, 0x3
    shl     ax, cl
    add     ax, offset rect_array_unk3
    mov     word ptr [bp+var_rectptr], ax
    mov     bx, ax
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    les     bx, [wndsprite]
    push    word ptr es:[bx+0x2]
    push    word ptr es:[bx]
    call    far ptr sprite_putimage
    add     sp, 0x4
    inc     si
LAB_19f1_0103:
    mov     al, byte ptr [rect_array_unk3_length]
    cbw
    cmp     ax, si
    jg      LAB_19f1_00c8
    jmp     LAB_19f1_014e
    db 0x90
LAB_19f1_010e:
    mov     bx, word ptr [bp+rect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    jmp     LAB_19f1_012e
LAB_19f1_0120:
    mov     bx, word ptr [bp+rect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
LAB_19f1_012e:
    call    far ptr sprite_set_1_size
    add     sp, 0x8
LAB_19f1_0136:
    call    far ptr mouse_draw_opaque_check
    les     bx, [wndsprite]
    push    word ptr es:[bx+0x2]
    push    word ptr es:[bx]
    call    far ptr sprite_putimage
    add     sp, 0x4
LAB_19f1_014e:
    call    far ptr mouse_draw_transparent_check
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_0180
    mov     ax, word ptr [word_463D6]
    mov     word ptr [word_449FE], ax
    sub     si, si
LAB_19f1_0162:
    mov     di, si
    mov     cl, 0x3
    shl     di, cl
    push    si
    push    di
    lea     si, [di+rect_array_unk]
    lea     di, [di+rect_array_unk2]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_0162
LAB_19f1_0180:
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
sub_19F14_asm_ endp

; void __cdecl16far init_rect_arrays(void)
init_rect_arrays_asm_ proc far
    push    bp
    mov     bp, sp
    sub     sp, 0x2
    push    di
    push    si
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_01de
    push    si
    mov     di, offset rect_array_unk
    mov     si, offset rect_unk5
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     si
    push    si
    mov     di, offset rect_array_unk2
    mov     si, offset rect_unk5
    movsw
    movsw
    movsw
    movsw
    pop     si
    mov     si, 0x1
LAB_19f1_01b2:
    mov     di, si
    mov     cl, 0x3
    shl     di, cl
    push    si
    push    di
    lea     di, [di+rect_array_unk]
    mov     si, offset cliprect_unk
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    push    si
    push    di
    lea     di, [di+rect_array_unk2]
    mov     si, offset cliprect_unk
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    inc     si
    cmp     si, 0xf                            ; there are 15 rects in the array
    jl      LAB_19f1_01b2
LAB_19f1_01de:
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
init_rect_arrays_asm_ endp

; void __cdecl16far update_frame(char unk, RECTANGLE * cliprect)
update_frame_asm_ proc far
    var_lastpos2lookup = dword ptr -340
    var_lastposlookupw = word ptr  -336
    var_transformresult = word ptr  -334
    var_14C    = byte ptr  -332
    var_posadjust = byte ptr  -308
    var_132    = word ptr  -306
    var_130    = byte ptr  -304
    var_trkobject_ptr = word ptr  -302
    var_poslookupadjust = byte ptr  -300
    var_12A    = word ptr  -298
    var_vec7   = byte ptr  -296
    var_122    = byte ptr  -290
    var_mat    = byte ptr  -288
    var_10E    = word ptr  -270
    terr_map_value = byte ptr  -268
    var_pos2adjust = byte ptr  -266
    var_108    = dword ptr -264
    var_stateptr = word ptr  -260
    var_poslookup = byte ptr  -258
    var_pos2lookupadjust = byte ptr  -256
    var_angZ   = word ptr  -254
    var_FC     = byte ptr  -252
    var_angX   = word ptr  -250
    var_pos2lookup = byte ptr  -246
    var_angY2  = word ptr  -244
    var_vec6   = byte ptr  -242
    var_vec5   = byte ptr  -236
    var_E4     = byte ptr  -228
    var_E2     = byte ptr  -226
    var_E0     = word ptr  -224
    var_multitileflag = word ptr  -222
    var_DC     = byte ptr  -220
    local_dd   = byte ptr  -219
    var_DA     = word ptr  -218
    var_D8     = byte ptr  -216
    var_matptr = word ptr  -214
    var_postab = byte ptr  -212
    var_BC     = byte ptr  -188
    var_A4     = word ptr  -164
    var_counter2 = word ptr  -162
    var_mat2   = byte ptr  -160
    var_rect2  = byte ptr  -142
    var_pos2tab = byte ptr  -134
    var_6E     = byte ptr  -110
    var_6C     = word ptr  -108
    var_rect   = byte ptr  -106
    elem_map_value = byte ptr  -98
    var_60     = byte ptr  -96
    var_5E     = word ptr  -94
    var_angY   = word ptr  -92
    var_angZ2  = word ptr  -90
    var_vec4   = byte ptr  -88
    var_52     = word ptr  -82
    var_50     = word ptr  -80
    var_4E     = byte ptr  -78
    var_4C     = byte ptr  -76
    var_4A     = byte ptr  -74
    var_hillheight = word ptr  -72
    var_angX2  = word ptr  -70
    var_vec8   = byte ptr  -68
    var_rectptr = word ptr  -62
    var_3C     = byte ptr  -60
    var_3A     = word ptr  -58
    var_38     = word ptr  -56
    var_counter = word ptr  -54
    var_trkobjectptr = word ptr  -52
    var_32     = byte ptr  -50
    var_1A     = byte ptr  -26
    var_2      = word ptr   -2
    unk        = byte ptr    6
    cliprect   = word ptr    8

    push    bp
    mov     bp, sp
    sub     sp, 0x154
    push    di
    push    si
    mov     byte ptr [bp+var_DC], 0x0
    mov     byte ptr [bp+local_dd], 0x0
    cmp     byte ptr [video_flag5_is0], 0x0
    jz      LAB_19f1_0212
    cmp     byte ptr [bp+unk], 0x0
    jz      LAB_19f1_0212
    mov     word ptr [rectptr_unk2], offset rect_array_unk
    mov     word ptr [rectptr_unk], offset rect_array_unk2
    jmp     LAB_19f1_021e
LAB_19f1_0212:
    mov     word ptr [rectptr_unk], offset rect_array_unk
    mov     word ptr [rectptr_unk2], offset rect_array_unk2
LAB_19f1_021e:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_0252
    mov     byte ptr [bp+var_122], 0x8
    mov     word ptr [bp+var_rectptr], offset rect_unk
    sub     si, si
    jmp     LAB_19f1_0235
    db 0x90
LAB_19f1_0234:
    inc     si
LAB_19f1_0235:
    cmp     si, 0xf
    jge     LAB_19f1_0257
    mov     ax, word ptr [bp+var_rectptr]
    add     word ptr [bp+var_rectptr], 0x8
    push    si
    push    di
    mov     di, ax
    mov     si, offset cliprect_unk
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    jmp     LAB_19f1_0234
LAB_19f1_0252:
    mov     byte ptr [bp+var_122], 0x0
LAB_19f1_0257:
    cmp     byte ptr [followOpponentFlag], 0x0
    jnz     LAB_19f1_02ae
    mov     ax, word ptr [state.playerstate.car_posWorld1.lx]
    mov     dx, word ptr [state.playerstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_0267:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_0267
    mov     word ptr [bp+var_vec5], ax
    mov     ax, word ptr [state.playerstate.car_posWorld1.ly]
    mov     dx, word ptr [state.playerstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_027c:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_027c
    mov     word ptr [bp+var_vec5+2], ax
    mov     ax, word ptr [state.playerstate.car_posWorld1.lz]
    mov     dx, word ptr [state.playerstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_0291:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_0291
    mov     word ptr [bp+var_vec5+4], ax
    mov     ax, word ptr [state.playerstate.car_rotate.vy]
    mov     word ptr [bp+var_angX2], ax
    mov     ax, word ptr [state.playerstate.car_rotate.vz]
    mov     word ptr [bp+var_angZ2], ax
    mov     ax, word ptr [state.playerstate.car_rotate.vx]
    jmp     LAB_19f1_02fc
LAB_19f1_02ae:
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_02b7:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_02b7
    mov     word ptr [bp+var_vec5], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.ly]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_02cc:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_02cc
    mov     word ptr [bp+var_vec5+2], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_02e1:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_02e1
    mov     word ptr [bp+var_vec5+4], ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vy]
    mov     word ptr [bp+var_angX2], ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vz]
    mov     word ptr [bp+var_angZ2], ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vx]
LAB_19f1_02fc:
    mov     word ptr [bp+var_angY2], ax
    mov     word ptr [bp+var_angY], 0xffff
    mov     word ptr [bp+var_E0], 0x0
    mov     al, byte ptr [cameramode]
    cbw
    or      ax, ax
    jnz     LAB_19f1_0316
    jmp     near ptr LAB_19f1_0524
LAB_19f1_0316:
    cmp     ax, 0x1
    jnz     LAB_19f1_031e
    jmp     near ptr LAB_19f1_04fa
LAB_19f1_031e:
    cmp     ax, 0x2
    jz      LAB_19f1_032e
    cmp     ax, 0x3
    jnz     LAB_19f1_032b
    jmp     near ptr LAB_19f1_057e
LAB_19f1_032b:
    jmp     near ptr LAB_19f1_03f3
LAB_19f1_032e:
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+2], 0x0
    mov     word ptr [bp+var_vec6+4], 0x4000
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_angY2]
    neg     ax
    push    ax
    mov     ax, word ptr [bp+var_angX2]
    neg     ax
    push    ax
    mov     ax, word ptr [bp+var_angZ2]
    neg     ax
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_matptr], ax
    lea     ax, [bp+var_vec7]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    push    word ptr [bp+var_vec7+4]
    push    word ptr [bp+var_vec7]
    call    far ptr int_atan2
    add     sp, 0x4
    mov     si, ax
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+2], 0x0
    mov     ax, word ptr [word_3B8EC]
    mov     word ptr [bp+var_vec6+4], ax
    sub     ax, ax
    push    ax
    mov     ax, si
    sub     ax, word ptr [word_3B8EE]
    push    ax
    mov     ax, word ptr [word_3B8F0]
    neg     ax
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_matptr], ax
LAB_19f1_03bc:
    lea     ax, [bp+var_vec7]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    mov     ax, word ptr [bp+var_vec5]
    add     ax, word ptr [bp+var_vec7]
    mov     word ptr [bp+var_vec4], ax
    mov     ax, word ptr [bp+var_vec5+2]
    add     ax, word ptr [bp+var_vec7+2]
    mov     word ptr [bp+var_vec4+2], ax
    mov     ax, word ptr [bp+var_vec5+4]
    add     ax, word ptr [bp+var_vec7+4]
LAB_19f1_03f0:
    mov     word ptr [bp+var_vec4+4], ax
LAB_19f1_03f3:
    cmp     word ptr [bp+var_angY], -0x1
    jz      LAB_19f1_03fc
    jmp     near ptr LAB_19f1_04d9
LAB_19f1_03fc:
    lea     ax, [bp+var_vec4]
    push    ax
    lea     ax, [bp+var_vec4]
    push    ax
    call    far ptr build_track_object
    add     sp, 0x4
    mov     ax, word ptr [terrainHeight]
    cmp     word ptr [bp+var_vec4+2], ax
    jge     LAB_19f1_0417
    mov     word ptr [bp+var_vec4+2], ax
LAB_19f1_0417:
    cmp     byte ptr [byte_4392C], 0x0
    jz      LAB_19f1_0483
    push    word ptr [bp+var_vec4+4]
    push    word ptr [bp+var_vec4+2]
    push    word ptr [bp+var_vec4]
    push    word ptr [planindex]
    call    far ptr plane_origin_op
    add     sp, 0x8
    mov     si, ax
    cmp     si, 0xc
    jge     LAB_19f1_0483
    mov     word ptr [vec_unk2], 0x0
    mov     ax, 0xc
    sub     ax, si
    mov     word ptr [vec_unk2.vy], ax
    mov     word ptr [vec_unk2.vz], 0x0
    mov     ax, word ptr [planindex]
    mov     word ptr [planindex_copy], ax
    mov     word ptr [pState_f36Mminf40sar2], 0x0
    mov     word ptr [pState_minusRotate_x_2], 0x0
    mov     word ptr [pState_minusRotate_z_2], 0x0
    mov     word ptr [pState_minusRotate_y_2], 0x0
    call    far ptr plane_rotate_op
    mov     ax, word ptr [vec_planerotopresult]
    add     word ptr [bp+var_vec4], ax
    mov     ax, word ptr [vec_planerotopresult.vy]
    add     word ptr [bp+var_vec4+2], ax
    mov     ax, word ptr [vec_planerotopresult.vz]
    add     word ptr [bp+var_vec4+4], ax
LAB_19f1_0483:
    mov     ax, word ptr [bp+var_vec5+4]
    sub     ax, word ptr [bp+var_vec4+4]
    push    ax
    mov     ax, word ptr [bp+var_vec5]
    sub     ax, word ptr [bp+var_vec4]
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    neg     ax
    and     ah, 0x3
    mov     word ptr [bp+var_angY], ax
    mov     ax, word ptr [bp+var_vec5+4]
    sub     ax, word ptr [bp+var_vec4+4]
    push    ax
    mov     ax, word ptr [bp+var_vec5]
    sub     ax, word ptr [bp+var_vec4]
    push    ax
    call    far ptr int_hypot
    add     sp, 0x4
    mov     word ptr [bp+var_38], ax
    push    ax
    mov     ax, word ptr [bp+var_vec5+2]
    sub     ax, word ptr [bp+var_vec4+2]
    add     ax, 0x32
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    and     ah, 0x3
    mov     word ptr [bp+var_angX], ax
LAB_19f1_04d9:
    cmp     word ptr [bp+var_E0], 0x1
    jg      LAB_19f1_04e3
    jmp     near ptr LAB_19f1_05c0
LAB_19f1_04e3:
    cmp     word ptr [bp+var_E0], 0x3ff
    jl      LAB_19f1_04ee
    jmp     near ptr LAB_19f1_05c0
LAB_19f1_04ee:
    mov     ax, word ptr [bp+var_E0]
    mov     word ptr [bp+var_angZ], ax
    jmp     near ptr LAB_19f1_05c6
    db 0x90
LAB_19f1_04fa:
    mov     al, byte ptr [followOpponentFlag]
    cbw
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     ax, word ptr [bx+state.game_vec1.vx]
    mov     word ptr [bp+var_vec4], ax
    mov     ax, word ptr [bx+state.game_vec1.vz]
    mov     word ptr [bp+var_vec4+4], ax
    mov     ax, word ptr [bx+state.game_vec1.vy]
    mov     word ptr [bp+var_vec4+2], ax
    jmp     near ptr LAB_19f1_03f3
LAB_19f1_0524:
    mov     ax, word ptr [bp+var_angY2]
    and     ah, 0x3
    mov     word ptr [bp+var_angY], ax
    mov     ax, word ptr [bp+var_angX2]
    and     ah, 0x3
    mov     word ptr [bp+var_angX], ax
    mov     ax, word ptr [bp+var_angZ2]
    and     ah, 0x3
    mov     word ptr [bp+var_E0], ax
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_angY2]
    neg     ax
    push    ax
    mov     ax, word ptr [bp+var_angX2]
    neg     ax
    push    ax
    mov     ax, word ptr [bp+var_angZ2]
    neg     ax
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_matptr], ax
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+4], 0x0
    mov     ax, word ptr [simd_player.car_height]
    sub     ax, 0x6
    mov     word ptr [bp+var_vec6+2], ax
    jmp     near ptr LAB_19f1_03bc
    db 0x90
LAB_19f1_057e:
    mov     al, byte ptr [followOpponentFlag]
    cbw
    mov     bx, ax
    mov     al, byte ptr [bx+state.field_3F7]
    cbw
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, word ptr [trackdata9]
    mov     dx, word ptr [trackdata9+2]
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     word ptr [bp+var_lastpos2lookup+2], dx
    les     bx, [bp+var_lastpos2lookup]
    mov     ax, word ptr es:[bx]
    mov     word ptr [bp+var_vec4], ax
    mov     ax, word ptr es:[bx+0x2]
    add     ax, word ptr [word_44D20]
    add     ax, 0x5a
    mov     word ptr [bp+var_vec4+2], ax
    mov     ax, word ptr es:[bx+0x4]
    jmp     near ptr LAB_19f1_03f0
LAB_19f1_05c0:
    mov     word ptr [bp+var_angZ], 0x0
LAB_19f1_05c6:
    cmp     word ptr [state.game_frame], 0x0
    jnz     LAB_19f1_05d4
    mov     bx, word ptr [word_46468]
    jmp     LAB_19f1_05d8
    db 0x90
LAB_19f1_05d4:
    mov     bx, word ptr [state.game_frame]
LAB_19f1_05d8:
    and     bx, 0xf
    mov     al, byte ptr [bx+byte_3C0C6]
    mov     byte ptr [bp+var_E4], al
    sub     ax, ax
    push    ax
    push    word ptr [bp+cliprect]
    push    word ptr [bp+var_angY]
    push    word ptr [bp+var_angX]
    push    word ptr [bp+var_angZ]
    call    far ptr select_cliprect_rotate
    add     sp, 0xa
    mov     word ptr [bp+var_52], ax
    and     ah, 0x3
    mov     cl, 0x7
    shr     ax, cl
    mov     si, ax
    mov     bx, si
    shl     bx, 0x1
    mov     ax, word ptr [bx+lookahead_tiles_tables]
    mov     word ptr [bp+var_50], ax
    mov     ax, 0x1
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [bp+var_angX]
    push    word ptr [bp+var_angZ]
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    push    si
    push    di
    lea     di, [bp+var_mat]
    mov     si, ax
    push    ss
    pop     es
    mov     cx, 0x9
    rep movsw
    pop     di
    pop     si
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+2], 0x0
    mov     word ptr [bp+var_vec6+4], 0x3e8
    lea     ax, [bp+var_vec8]
    push    ax
    lea     ax, [bp+var_mat]
    push    ax
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec8+4], 0x0
    jle     LAB_19f1_0670
    mov     word ptr [bp+var_2], 0x1
    jmp     LAB_19f1_0675
LAB_19f1_0670:
    mov     word ptr [bp+var_2], 0xffff
LAB_19f1_0675:
    cmp     byte ptr [detail_level], 0x0
    jz      LAB_19f1_067f
    jmp     near ptr LAB_19f1_075d
LAB_19f1_067f:
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk9
    mov     al, byte ptr [bp+var_122]
    or      al, 0x7
    mov     byte ptr [currenttransshape.ts_flags], al
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     word ptr [currenttransshape.ts_unk], 0x400
    mov     byte ptr [currenttransshape.ts_material], 0x0
    mov     word ptr [bp+var_counter], 0x0
LAB_19f1_06aa:
    mov     bx, word ptr [bp+var_counter]
    shl     bx, 0x1
    mov     si, word ptr [bx+word_3BE34]
    add     si, word ptr [bp+var_angY]
    add     si, word ptr [run_game_random]
    and     si, 0x3ff
    cmp     si, 0x87
    jl      LAB_19f1_06cd
    cmp     si, 0x379
    jg      LAB_19f1_06cd
    jmp     near ptr LAB_19f1_0751
LAB_19f1_06cd:
    push    si
    lea     ax, [bp+var_mat2]
    push    ax
    call    far ptr mat_rot_y
    add     sp, 0x4
    mov     word ptr [bp+var_vec6], 0x0
    mov     ax, 0xae6
    sub     ax, word ptr [bp+var_vec4+2]
    mov     word ptr [bp+var_vec6+2], ax
    mov     word ptr [bp+var_vec6+4], 0x3a98   ; 15000
    lea     ax, [bp+var_vec7]
    push    ax
    lea     ax, [bp+var_mat2]
    push    ax
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    mov     word ptr [bp+var_vec7+4], 0x3a98   ; 15000
    mov     ax, offset currenttransshape
    push    ax
    lea     ax, [bp+var_mat]
    push    ax
    lea     ax, [bp+var_vec7]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [currenttransshape.ts_pos.vz], 0xc8
    jle     LAB_19f1_0751
    mov     bx, word ptr [bp+var_counter]
    shl     bx, 0x1
    mov     ax, word ptr [bx+off_3BE44]
    mov     word ptr [currenttransshape.ts_shapeptr], ax
    mov     ax, word ptr [bp+var_angY]
    neg     ax
    mov     word ptr [currenttransshape.ts_rotvec.vz], ax
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
LAB_19f1_0751:
    inc     word ptr [bp+var_counter]
    cmp     word ptr [bp+var_counter], 0x8
    jge     LAB_19f1_075d
    jmp     near ptr LAB_19f1_06aa
LAB_19f1_075d:
    mov     ax, word ptr [bp+var_vec4]
    mov     cl, 0xa
    sar     ax, cl
    mov     byte ptr [bp+var_pos2adjust], al
    mov     ax, word ptr [bp+var_vec4+4]
    sar     ax, cl
    sub     al, 0x1d
    neg     al
    mov     byte ptr [bp+var_posadjust], al
    cmp     byte ptr [detail_level], 0x0
    jz      LAB_19f1_078d
    mov     al, byte ptr [state.playerstate.car_posWorld1.lx+2]
    mov     byte ptr [bp+var_D8], al
    mov     al, 0x1d
    sub     al, byte ptr [state.playerstate.car_posWorld1.lz+2]
    mov     byte ptr [bp+var_E2], al
LAB_19f1_078d:
    sub     si, si
LAB_19f1_078f:
    mov     byte ptr [bp+si-0x32], 0x0
    inc     si
    cmp     si, 0x17
    jl      LAB_19f1_078f
    mov     bl, byte ptr [detail_level]
    sub     bh, bh
    mov     al, byte ptr [bx+detail_threshold_by_level]
    mov     byte ptr [bp+var_130], al
    mov     si, 0x16
    jmp     LAB_19f1_07ef
LAB_19f1_07ac:
    mov     ax, word ptr [bp+var_50]
    mov     cx, si
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    add     ax, cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    mov     al, byte ptr [bx]
    add     al, byte ptr [bp+var_pos2adjust]
    mov     byte ptr [bp+var_pos2lookup], al
    mov     al, byte ptr [bx+0x1]
    add     al, byte ptr [bp+var_posadjust]
    mov     byte ptr [bp+var_poslookup], al
    cmp     byte ptr [bp+var_pos2lookup], 0x0
    jl      LAB_19f1_07ea
    cmp     byte ptr [bp+var_pos2lookup], 0x1d
    jg      LAB_19f1_07ea
    or      al, al
    jl      LAB_19f1_07ea
    cmp     al, 0x1d
    jle     LAB_19f1_0814
LAB_19f1_07ea:
    mov     byte ptr [bp+si-0x32], 0x2
LAB_19f1_07ee:
    dec     si
LAB_19f1_07ef:
    or      si, si
    jge     LAB_19f1_07f6
    jmp     near ptr LAB_19f1_0ab8
LAB_19f1_07f6:
    cmp     byte ptr [bp+si-0x32], 0x0
    jnz     LAB_19f1_07ee
    mov     bx, word ptr [bp+var_50]
    mov     ax, si
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    add     bx, ax
    mov     al, byte ptr [bp+var_130]
    cmp     byte ptr [bx+0x2], al
    jle     LAB_19f1_07ac
    jmp     LAB_19f1_07ea
LAB_19f1_0814:
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     bx, word ptr [bx+trackrows]
    add     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [td14_elem_map_main]
    mov     es, word ptr [td14_elem_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+elem_map_value], al
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     bx, word ptr [bx+terrainrows]
    add     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [td15_terr_map_main]
    mov     es, word ptr [td15_terr_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+terr_map_value], al
    cmp     byte ptr [bp+elem_map_value], 0x0
    jnz     LAB_19f1_0864
    jmp     near ptr LAB_19f1_08ef
LAB_19f1_0864:
    cmp     al, 0x7
    jc      LAB_19f1_0887
    cmp     al, 0xb
    jnc     LAB_19f1_0887
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    push    ax
    mov     al, byte ptr [bp+terr_map_value]
    push    ax
    call    far ptr subst_hillroad_track
    add     sp, 0x4
    mov     byte ptr [bp+elem_map_value], al
    mov     byte ptr [bp+terr_map_value], 0x0
LAB_19f1_0887:
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    cmp     ax, 0xfd
    jz      LAB_19f1_08a0
    cmp     ax, 0xfe
    jz      LAB_19f1_08a4
    cmp     ax, 0xff
    jnz     LAB_19f1_089e
    jmp     near ptr LAB_19f1_09ba
LAB_19f1_089e:
    jmp     LAB_19f1_08ef
LAB_19f1_08a0:
    dec     byte ptr [bp+var_pos2lookup]
LAB_19f1_08a4:
    dec     byte ptr [bp+var_poslookup]
LAB_19f1_08a8:
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     bx, word ptr [bx+trackrows]
    add     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [td14_elem_map_main]
    mov     es, word ptr [td14_elem_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+elem_map_value], al
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     bx, word ptr [bx+terrainrows]
    add     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [td15_terr_map_main]
    mov     es, word ptr [td15_terr_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+terr_map_value], al
LAB_19f1_08ef:
    mov     al, byte ptr [bp+terr_map_value]
    mov     byte ptr [bp+si-0x1a], al
    mov     bx, word ptr [bp+var_50]
    mov     ax, si
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    add     bx, ax
    mov     al, byte ptr [bx+0x2]
    mov     byte ptr [bp+si+0xff44], al
    cmp     byte ptr [bp+elem_map_value], 0x0
    jz      LAB_19f1_0947
    cmp     byte ptr [detail_level], 0x0
    jz      LAB_19f1_0947
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    cmp     byte ptr [bx+trkObjectList.ss_physicalModel], 0x40
    jl      LAB_19f1_0947
    mov     al, byte ptr [bp+var_D8]
    cmp     byte ptr [bp+var_pos2lookup], al
    jnz     LAB_19f1_0943
    mov     al, byte ptr [bp+var_E2]
    cmp     byte ptr [bp+var_poslookup], al
    jz      LAB_19f1_0947
LAB_19f1_0943:
    mov     byte ptr [bp+elem_map_value], 0x0
LAB_19f1_0947:
    mov     al, byte ptr [bp+var_pos2lookup]
    mov     byte ptr [bp+si+0xff7a], al
    mov     al, byte ptr [bp+var_poslookup]
    mov     byte ptr [bp+si+0xff2c], al
    mov     al, byte ptr [bp+elem_map_value]
    mov     byte ptr [bp+si+0xfeb4], al
    cmp     byte ptr [bp+elem_map_value], 0x0
    jnz     LAB_19f1_0967
    jmp     near ptr LAB_19f1_07ee
LAB_19f1_0967:
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    mov     al, byte ptr [bx+trkObjectList.ss_multiTileFlag]
    cbw
    mov     word ptr [bp+var_multitileflag], ax
    or      ax, ax
    jnz     LAB_19f1_0988
    jmp     near ptr LAB_19f1_07ee
LAB_19f1_0988:
    mov     al, byte ptr [bp+var_pos2lookup]
    sub     al, byte ptr [bp+var_pos2adjust]
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     al, byte ptr [bp+var_poslookup]
    sub     al, byte ptr [bp+var_posadjust]
    mov     byte ptr [bp+var_poslookupadjust], al
    mov     ax, word ptr [bp+var_multitileflag]
    cmp     ax, 0x1
    jz      LAB_19f1_09c2
    cmp     ax, 0x2
    jz      LAB_19f1_0a04
    cmp     ax, 0x3
    jnz     LAB_19f1_09b6
    jmp     near ptr LAB_19f1_0a50
LAB_19f1_09b6:
    jmp     near ptr LAB_19f1_07ee
    db 0x90
LAB_19f1_09ba:
    dec     byte ptr [bp+var_pos2lookup]
    jmp     near ptr LAB_19f1_08a8
    db 0x90
LAB_19f1_09c2:
    sub     di, di
    jmp     LAB_19f1_09c7
LAB_19f1_09c6:
    inc     di
LAB_19f1_09c7:
    cmp     di, si
    jl      LAB_19f1_09ce
    jmp     near ptr LAB_19f1_07ee
LAB_19f1_09ce:
    mov     ax, word ptr [bp+var_50]
    mov     cx, di
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    add     ax, cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cmp     byte ptr [bx], al
    jnz     LAB_19f1_09c6
    mov     al, byte ptr [bp+var_poslookupadjust]
    cmp     byte ptr [bx+0x1], al
    jz      LAB_19f1_09fe
    cbw
    inc     ax
    mov     cx, ax
    mov     al, byte ptr [bx+0x1]
    cbw
    cmp     ax, cx
    jnz     LAB_19f1_09c6
LAB_19f1_09fe:
    mov     byte ptr [bp+di-0x32], 0x1
    jmp     LAB_19f1_09c6
LAB_19f1_0a04:
    sub     di, di
    jmp     LAB_19f1_0a09
LAB_19f1_0a08:
    inc     di
LAB_19f1_0a09:
    cmp     di, si
    jl      LAB_19f1_0a10
    jmp     near ptr LAB_19f1_07ee
LAB_19f1_0a10:
    mov     ax, word ptr [bp+var_50]
    mov     cx, di
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    add     ax, cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    mov     al, byte ptr [bp+var_poslookupadjust]
    cmp     byte ptr [bx+0x1], al
    jnz     LAB_19f1_0a08
    mov     al, byte ptr [bx]
    mov     byte ptr [bp+var_lastposlookupw], al
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cmp     byte ptr [bp+var_lastposlookupw], al
    jz      LAB_19f1_0a49
    cbw
    inc     ax
    mov     cx, ax
    mov     al, byte ptr [bp+var_lastposlookupw]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0a08
LAB_19f1_0a49:
    mov     byte ptr [bp+di-0x32], 0x1
    jmp     LAB_19f1_0a08
    db 0x90
LAB_19f1_0a50:
    sub     di, di
    jmp     LAB_19f1_0a55
LAB_19f1_0a54:
    inc     di
LAB_19f1_0a55:
    cmp     di, si
    jl      LAB_19f1_0a5c
    jmp     near ptr LAB_19f1_07ee
LAB_19f1_0a5c:
    mov     bx, word ptr [bp+var_50]
    mov     ax, di
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    add     bx, ax
    mov     al, byte ptr [bx]
    mov     byte ptr [bp+var_lastpos2lookup], al
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cmp     byte ptr [bp+var_lastpos2lookup], al
    jz      LAB_19f1_0a86
    cbw
    inc     ax
    mov     cx, ax
    mov     al, byte ptr [bp+var_lastpos2lookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0a54
LAB_19f1_0a86:
    mov     bx, word ptr [bp+var_50]
    mov     ax, di
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    add     bx, ax
    mov     al, byte ptr [bx+0x1]
    mov     byte ptr [bp+var_lastpos2lookup], al
    mov     al, byte ptr [bp+var_poslookupadjust]
    cmp     byte ptr [bp+var_lastpos2lookup], al
    jz      LAB_19f1_0ab1
    cbw
    inc     ax
    mov     cx, ax
    mov     al, byte ptr [bp+var_lastpos2lookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0a54
LAB_19f1_0ab1:
    mov     byte ptr [bp+di-0x32], 0x1
    jmp     LAB_19f1_0a54
    db 0x90
LAB_19f1_0ab8:
    mov     byte ptr [bp+var_3C], 0xff
    mov     word ptr [bp+var_6C], 0x0
    cmp     byte ptr [cameramode], 0x0
    jnz     LAB_19f1_0ad2
    cmp     byte ptr [followOpponentFlag], 0x0
    jnz     LAB_19f1_0ad2
    jmp     near ptr LAB_19f1_0c55
LAB_19f1_0ad2:
    cmp     byte ptr [state.playerstate.car_crashBmpFlag], 0x2
    jnz     LAB_19f1_0adc
    jmp     near ptr LAB_19f1_0c55
LAB_19f1_0adc:
    sub     ax, ax
    push    ax
    mov     ax, word ptr [state.playerstate.car_rotate.vx]
    neg     ax
    push    ax
    mov     ax, word ptr [state.playerstate.car_rotate.vy]
    neg     ax
    push    ax
    mov     ax, word ptr [state.playerstate.car_rotate.vz]
    neg     ax
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_matptr], ax
    mov     word ptr [bp+var_multitileflag], 0xffff
    mov     di, 0xffff
    mov     word ptr [bp+var_counter2], 0x0
    jmp     LAB_19f1_0b7c
LAB_19f1_0b0e:
    dec     si
LAB_19f1_0b0f:
    cmp     word ptr [bp+var_multitileflag], si
    jge     LAB_19f1_0b78
    cmp     byte ptr [bp+si-0x32], 0x2
    jz      LAB_19f1_0b0e
    mov     ax, word ptr [bp+var_50]
    mov     cx, si
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    add     ax, cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     al, byte ptr [bp+var_pos2adjust]
    cbw
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     cx, ax
    mov     al, byte ptr [bx]
    cbw
    add     ax, cx
    mov     cx, ax
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0b0e
    mov     al, byte ptr [bp+var_posadjust]
    cbw
    mov     cx, ax
    mov     al, byte ptr [bx+0x1]
    cbw
    add     ax, cx
    mov     cx, ax
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0b0e
    mov     al, byte ptr [bp+var_pos2lookup]
    mov     byte ptr [bp+var_3C], al
    mov     al, byte ptr [bp+var_poslookup]
    mov     byte ptr [bp+var_60], al
    mov     word ptr [bp+var_multitileflag], si
    mov     di, word ptr [bp+var_counter2]
    jmp     LAB_19f1_0b0e
    db 0x90
LAB_19f1_0b78:
    inc     word ptr [bp+var_counter2]
; A loop around car wheels...  
LAB_19f1_0b7c:
    cmp     word ptr [bp+var_counter2], 0x4
    jge     LAB_19f1_0be4
    mov     bx, word ptr [bp+var_counter2]
    mov     ax, bx
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    push    si
    push    di
    lea     di, [bp+var_vec6]
    lea     si, [bx+simd_player.wheel_coords.vx]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    lea     ax, [bp+var_vec8]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector             ; rotating car wheels, maybe?
    add     sp, 0x6
    mov     ax, word ptr [bp+var_vec8]
    cwd
    add     ax, word ptr [state.playerstate.car_posWorld1.lx]
    adc     dx, word ptr [state.playerstate.car_posWorld1.lx+2]
    mov     ax, dx
    mov     byte ptr [bp+var_pos2lookup], al
    mov     ax, word ptr [bp+var_vec8+4]
    cwd
    add     ax, word ptr [state.playerstate.car_posWorld1.lz]
    adc     dx, word ptr [state.playerstate.car_posWorld1.lz+2]
    mov     ax, dx
    sub     al, 0x1d
    neg     al
    mov     byte ptr [bp+var_poslookup], al
    mov     si, 0x16
    jmp     near ptr LAB_19f1_0b0f
    db 0x90
LAB_19f1_0be4:
    cmp     di, -0x1
    jz      LAB_19f1_0c55
    cmp     byte ptr [state.playerstate.car_surfaceWhl], 0x4
    jnz     LAB_19f1_0c05
    cmp     byte ptr [state.playerstate.(car_surfaceWhl+1)], 0x4
    jnz     LAB_19f1_0c05
    cmp     byte ptr [state.playerstate.(car_surfaceWhl+2)], 0x4
    jnz     LAB_19f1_0c05
    cmp     byte ptr [state.playerstate.(car_surfaceWhl+3)], 0x4
    jz      LAB_19f1_0c55
LAB_19f1_0c05:
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+4], 0x0
    mov     word ptr [bp+var_vec6+2], 0x7530
    lea     ax, [bp+var_vec8]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    lea     ax, [bp+var_vec6]
    push    ax
    mov     ax, offset mat_temp
    push    ax
    lea     ax, [bp+var_vec8]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec6+4], 0x0
    jg      LAB_19f1_0c50
    mov     word ptr [bp+var_6C], 0xf800
    jmp     LAB_19f1_0c55
    db 0x90
LAB_19f1_0c50:
    mov     word ptr [bp+var_6C], 0x800
LAB_19f1_0c55:
    mov     byte ptr [bp+var_4A], 0xff
    mov     word ptr [bp+var_A4], 0x0
    cmp     byte ptr [gameconfig.game_opponenttype], 0x0
    jnz     LAB_19f1_0c69
    jmp     near ptr LAB_19f1_0dfe
LAB_19f1_0c69:
    cmp     byte ptr [cameramode], 0x0
    jnz     LAB_19f1_0c7a
    cmp     byte ptr [followOpponentFlag], 0x0
    jz      LAB_19f1_0c7a
    jmp     near ptr LAB_19f1_0dfe
LAB_19f1_0c7a:
    cmp     byte ptr [state.opponentstate.car_crashBmpFlag], 0x2
    jnz     LAB_19f1_0c84
    jmp     near ptr LAB_19f1_0dfe
LAB_19f1_0c84:
    sub     ax, ax
    push    ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vx]
    neg     ax
    push    ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vy]
    neg     ax
    push    ax
    mov     ax, word ptr [state.opponentstate.car_rotate.vz]
    neg     ax
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_matptr], ax
    mov     word ptr [bp+var_multitileflag], 0xffff
    mov     di, 0xffff
    mov     word ptr [bp+var_counter2], 0x0
    jmp     LAB_19f1_0d24
LAB_19f1_0cb6:
    dec     si
LAB_19f1_0cb7:
    cmp     word ptr [bp+var_multitileflag], si
    jge     LAB_19f1_0d20
    cmp     byte ptr [bp+si-0x32], 0x2
    jz      LAB_19f1_0cb6
    mov     ax, word ptr [bp+var_50]
    mov     cx, si
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    add     ax, cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     al, byte ptr [bp+var_pos2adjust]
    cbw
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     cx, ax
    mov     al, byte ptr [bx]
    cbw
    add     ax, cx
    mov     cx, ax
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0cb6
    mov     al, byte ptr [bp+var_posadjust]
    cbw
    mov     cx, ax
    mov     al, byte ptr [bx+0x1]
    cbw
    add     ax, cx
    mov     cx, ax
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    cmp     cx, ax
    jnz     LAB_19f1_0cb6
    mov     al, byte ptr [bp+var_pos2lookup]
    mov     byte ptr [bp+var_4A], al
    mov     al, byte ptr [bp+var_poslookup]
    mov     byte ptr [bp+var_6E], al
    mov     word ptr [bp+var_multitileflag], si
    mov     di, word ptr [bp+var_counter2]
    jmp     LAB_19f1_0cb6
    db 0x90
LAB_19f1_0d20:
    inc     word ptr [bp+var_counter2]
LAB_19f1_0d24:
    cmp     word ptr [bp+var_counter2], 0x4
    jge     LAB_19f1_0d8c
    mov     bx, word ptr [bp+var_counter2]
    mov     ax, bx
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    push    si
    push    di
    lea     di, [bp+var_vec6]
    lea     si, [bx+simd_opponent.wheel_coords.vx]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    lea     ax, [bp+var_vec8]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    mov     ax, word ptr [bp+var_vec8]
    cwd
    add     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    adc     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     ax, dx
    mov     byte ptr [bp+var_pos2lookup], al
    mov     ax, word ptr [bp+var_vec8+4]
    cwd
    add     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    adc     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     ax, dx
    sub     al, 0x1d
    neg     al
    mov     byte ptr [bp+var_poslookup], al
    mov     si, 0x16
    jmp     near ptr LAB_19f1_0cb7
    db 0x90
LAB_19f1_0d8c:
    cmp     di, -0x1
    jz      LAB_19f1_0dfe
    cmp     byte ptr [state.opponentstate.car_surfaceWhl], 0x4
    jnz     LAB_19f1_0dad
    cmp     byte ptr [state.opponentstate.(car_surfaceWhl+1)], 0x4
    jnz     LAB_19f1_0dad
    cmp     byte ptr [state.opponentstate.(car_surfaceWhl+2)], 0x4
    jnz     LAB_19f1_0dad
    cmp     byte ptr [state.opponentstate.(car_surfaceWhl+3)], 0x4
    jz      LAB_19f1_0dfe
LAB_19f1_0dad:
    mov     word ptr [bp+var_vec6], 0x0
    mov     word ptr [bp+var_vec6+4], 0x0
    mov     word ptr [bp+var_vec6+2], 0x7530
    lea     ax, [bp+var_vec8]
    push    ax
    push    word ptr [bp+var_matptr]
    lea     ax, [bp+var_vec6]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    lea     ax, [bp+var_vec6]
    push    ax
    mov     ax, offset mat_temp
    push    ax
    lea     ax, [bp+var_vec8]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec6+4], 0x0
    jg      LAB_19f1_0df8
    mov     word ptr [bp+var_A4], 0xf800
    jmp     LAB_19f1_0dfe
LAB_19f1_0df8:
    mov     word ptr [bp+var_A4], 0x800
LAB_19f1_0dfe:
    mov     byte ptr [bp+var_4E], 0x0
    sub     si, si
    jmp     near ptr LAB_19f1_205d
    db 0x90
LAB_19f1_0e08:
    mov     word ptr [bp+var_counter], 0x1
    mov     word ptr [bp+var_10E], offset unk_3C0EE
    jmp     LAB_19f1_0e45
    db 0x90
LAB_19f1_0e16:
    mov     word ptr [bp+var_counter], 0x2
    mov     word ptr [bp+var_10E], offset unk_3C0F0
    jmp     LAB_19f1_0e45
    db 0x90
LAB_19f1_0e24:
    mov     word ptr [bp+var_counter], 0x3
    jmp     LAB_19f1_0e3f
    db 0x90
LAB_19f1_0e2c:
    mov     word ptr [bp+var_counter], 0x4
    mov     word ptr [bp+var_10E], offset unk_3C0F8
    jmp     LAB_19f1_0e45
    db 0x90
LAB_19f1_0e3a:
    mov     word ptr [bp+var_counter], 0x1
LAB_19f1_0e3f:
    mov     word ptr [bp+var_10E], offset unk_3C0F4
LAB_19f1_0e45:
    mov     word ptr [bp+var_multitileflag], 0x0
    jmp     near ptr LAB_19f1_0f6a
LAB_19f1_0e4e:
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cbw
    or      ax, ax
    jz      LAB_19f1_0e70
    cmp     ax, 0x1d
    jz      LAB_19f1_0ebc
    mov     al, byte ptr [bp+var_poslookupadjust]
    cbw
    or      ax, ax
    jz      LAB_19f1_0edc
    cmp     ax, 0x1d
    jz      LAB_19f1_0ee0
    mov     di, 0xffff
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0e70:
    mov     al, byte ptr [bp+var_poslookupadjust]
    cbw
    or      ax, ax
    jz      LAB_19f1_0e84
    cmp     ax, 0x1d
    jz      LAB_19f1_0eb6
    mov     di, 0x6
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0e84:
    mov     di, 0x7
LAB_19f1_0e87:
    cmp     di, -0x1
    jnz     LAB_19f1_0e8f
    jmp     near ptr LAB_19f1_0f66
LAB_19f1_0e8f:
    mov     al, byte ptr [di+fence_TrkObjCodes] ; indices to corner shapes?
                                               ; Using TrkObj offsets and
                                               ; the list of 3Dshape res.
                                               ; IDs (aBarn, etc.) to trace
                                               ; what is being loaded, one
                                               ; finds that these are
                                               ; actually the fences.
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_trkobjectptr], ax
    cmp     byte ptr [bp+var_FC], 0x0
    jnz     LAB_19f1_0ee6
    mov     bx, ax
    mov     ax, word ptr [bx+0x4]
    jmp     LAB_19f1_0eec
    db 0x90
LAB_19f1_0eb6:
    mov     di, 0x5
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0ebc:
    mov     al, byte ptr [bp+var_poslookupadjust]
    cbw
    or      ax, ax
    jz      LAB_19f1_0ed0
    cmp     ax, 0x1d
    jz      LAB_19f1_0ed6
    mov     di, 0x2
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0ed0:
    mov     di, 0x1
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0ed6:
    mov     di, 0x3
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0edc:
    sub     di, di
    jmp     LAB_19f1_0e87
LAB_19f1_0ee0:
    mov     di, 0x4
    jmp     LAB_19f1_0e87
    db 0x90
LAB_19f1_0ee6:
    mov     bx, word ptr [bp+var_trkobjectptr]
    mov     ax, word ptr [bx+0x6]
LAB_19f1_0eec:
    mov     word ptr [currenttransshape.ts_shapeptr], ax
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [currenttransshape], ax
    mov     ax, word ptr [bp+var_vec4+2]
    neg     ax
    mov     word ptr [currenttransshape.ts_pos.vy], ax
    mov     al, byte ptr [bp+var_poslookupadjust]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos]
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [currenttransshape.ts_pos.vz], ax
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk2
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [currenttransshape.ts_flags], al
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     bx, di
    shl     bx, 0x1
    mov     ax, word ptr [bx+word_3C0D6]
    mov     word ptr [currenttransshape.ts_rotvec.vz], ax
    mov     word ptr [currenttransshape.ts_unk], 0x400
    mov     byte ptr [currenttransshape.ts_material], 0x0
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_0f66
    jmp     near ptr LAB_19f1_112c
LAB_19f1_0f66:
    inc     word ptr [bp+var_multitileflag]
LAB_19f1_0f6a:
    mov     ax, word ptr [bp+var_counter]
    cmp     word ptr [bp+var_multitileflag], ax
    jge     LAB_19f1_0fbc
    mov     ax, word ptr [bp+var_multitileflag]
    shl     ax, 0x1
    add     ax, word ptr [bp+var_10E]
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    mov     al, byte ptr [bx]
    add     al, byte ptr [bp+var_pos2lookup]
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     al, byte ptr [bx+0x1]
    add     al, byte ptr [bp+var_poslookup]
    mov     byte ptr [bp+var_poslookupadjust], al
    cmp     byte ptr [detail_level], 0x0
    jnz     LAB_19f1_0fa2
    jmp     near ptr LAB_19f1_0e4e
LAB_19f1_0fa2:
    mov     al, byte ptr [bp+var_D8]
    cmp     byte ptr [bp+var_pos2lookupadjust], al
    jnz     LAB_19f1_0f66
    mov     al, byte ptr [bp+var_E2]
    cmp     byte ptr [bp+var_poslookupadjust], al
    jnz     LAB_19f1_0fb9
    jmp     near ptr LAB_19f1_0e4e
LAB_19f1_0fb9:
    jmp     LAB_19f1_0f66
    db 0x90
LAB_19f1_0fbc:
    cmp     byte ptr [bp+terr_map_value], 0x6
    jnz     LAB_19f1_1040
    mov     ax, word ptr [(hillHeightConsts+1*2)]
    mov     word ptr [bp+var_hillheight], ax
    cmp     byte ptr [bp+elem_map_value], 0x0
    jz      LAB_19f1_0fd4
LAB_19f1_0fcf:
    mov     byte ptr [bp+terr_map_value], 0x0
LAB_19f1_0fd4:
    cmp     byte ptr [bp+terr_map_value], 0x0
    jnz     LAB_19f1_0fde
    jmp     near ptr LAB_19f1_120c
LAB_19f1_0fde:
    mov     al, byte ptr [bp+terr_map_value]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes2
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     bx, ax
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [currenttransshape.ts_shapeptr], ax
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [currenttransshape], ax
    mov     ax, word ptr [bp+var_hillheight]
    sub     ax, word ptr [bp+var_vec4+2]
    mov     word ptr [currenttransshape.ts_pos.vy], ax
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos]
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [currenttransshape.ts_pos.vz], ax
    cmp     word ptr [bp+var_hillheight], 0x0
    jz      LAB_19f1_1037
    jmp     near ptr LAB_19f1_11c4
LAB_19f1_1037:
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk2
    jmp     near ptr LAB_19f1_11ca
LAB_19f1_1040:
    mov     word ptr [bp+var_hillheight], 0x0
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    cmp     ax, 0x69
    jc      LAB_19f1_0fd4
    cmp     ax, 0x6c
    jbe     LAB_19f1_1057
    jmp     near ptr LAB_19f1_0fd4
LAB_19f1_1057:
    mov     word ptr [bp+var_multitileflag], 0x0
    jmp     near ptr LAB_19f1_119c
LAB_19f1_1060:
    mov     al, byte ptr [bp+var_pos2lookup]
LAB_19f1_1064:
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     al, byte ptr [bp+var_poslookup]
LAB_19f1_106c:
    mov     byte ptr [bp+var_poslookupadjust], al
LAB_19f1_1070:
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cbw
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     al, byte ptr [bp+var_poslookupadjust]
    cbw
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     bx, word ptr [bx+0x8c3c]
    add     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [td15_terr_map_main]
    mov     es, word ptr [td15_terr_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+terr_map_value], al
    or      al, al
    jnz     LAB_19f1_10a4
    jmp     near ptr LAB_19f1_1198
LAB_19f1_10a4:
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes2
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     bx, ax
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [currenttransshape.ts_shapeptr], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [currenttransshape], ax
    mov     ax, word ptr [bp+var_vec4+2]
    neg     ax
    mov     word ptr [currenttransshape.ts_pos.vy], ax
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+trackcenterpos]
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [currenttransshape.ts_pos.vz], ax
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk2
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [currenttransshape.ts_flags], al
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [currenttransshape.ts_rotvec.vz], ax
    mov     word ptr [currenttransshape.ts_unk], 0x400
    mov     byte ptr [currenttransshape.ts_material], 0x0
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_1198
LAB_19f1_112c:
    push    word ptr [bp+var_vec4+2]
    push    word ptr [bp+var_angY]
    push    word ptr [bp+var_angZ]
    lea     ax, [bp+var_mat]
    push    ax
    push    word ptr [bp+var_2]
    push    word ptr [bp+cliprect]
    mov     al, byte ptr [bp+unk]
    cbw
    push    ax
    push    cs
    call    near ptr skybox_op
    add     sp, 0xe
    mov     word ptr [bp+var_132], ax
    mov     bx, word ptr [bp+cliprect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    call    far ptr get_a_poly_info
    sub     si, si
    jmp     near ptr LAB_19f1_21b2
    db 0x90
LAB_19f1_1174:
    mov     al, byte ptr [bp+var_pos2lookup]
    inc     al
    jmp     near ptr LAB_19f1_1064
    db 0x90
LAB_19f1_117e:
    mov     al, byte ptr [bp+var_pos2lookup]
LAB_19f1_1182:
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     al, byte ptr [bp+var_poslookup]
    inc     al
    jmp     near ptr LAB_19f1_106c
    db 0x90
LAB_19f1_1190:
    mov     al, byte ptr [bp+var_pos2lookup]
    inc     al
    jmp     LAB_19f1_1182
LAB_19f1_1198:
    inc     word ptr [bp+var_multitileflag]
LAB_19f1_119c:
    cmp     word ptr [bp+var_multitileflag], 0x4
    jl      LAB_19f1_11a6
    jmp     near ptr LAB_19f1_0fcf
LAB_19f1_11a6:
    mov     ax, word ptr [bp+var_multitileflag]
    or      ax, ax
    jnz     LAB_19f1_11b1
    jmp     near ptr LAB_19f1_1060
LAB_19f1_11b1:
    cmp     ax, 0x1
    jz      LAB_19f1_1174
    cmp     ax, 0x2
    jz      LAB_19f1_117e
    cmp     ax, 0x3
    jz      LAB_19f1_1190
    jmp     near ptr LAB_19f1_1070
    db 0x90
LAB_19f1_11c4:
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk6
LAB_19f1_11ca:
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [currenttransshape.ts_flags], al
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [currenttransshape.ts_rotvec.vz], ax
    mov     word ptr [currenttransshape.ts_unk], 0x400
    mov     byte ptr [currenttransshape.ts_material], 0x0
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_120c
    jmp     near ptr LAB_19f1_112c
LAB_19f1_120c:
    mov     byte ptr [transformedshape_counter], 0x0
    mov     word ptr [curtransshape_ptr], offset currenttransshape
    cmp     byte ptr [bp+elem_map_value], 0x0
    jnz     LAB_19f1_1220
    jmp     near ptr LAB_19f1_180e
LAB_19f1_1220:
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     bx, ax
    test    byte ptr [bx+0xb], 0x1
    jz      LAB_19f1_1258
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackpos]
    mov     word ptr [bp+var_5E], ax
    mov     al, byte ptr [bp+var_poslookup]
    inc     al
    jmp     LAB_19f1_126c
LAB_19f1_1258:
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos]
    mov     word ptr [bp+var_5E], ax
    mov     al, byte ptr [bp+var_poslookup]
LAB_19f1_126c:
    mov     byte ptr [bp+var_poslookupadjust], al
    mov     bx, word ptr [bp+var_trkobject_ptr]
    test    byte ptr [bx+0xb], 0x2
    jz      LAB_19f1_1292
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+(trackpos2+1*2)]
    mov     word ptr [bp+var_3A], ax
    mov     al, byte ptr [bp+var_pos2lookup]
    inc     al
    jmp     LAB_19f1_12a6
LAB_19f1_1292:
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    mov     word ptr [bp+var_3A], ax
    mov     al, byte ptr [bp+var_pos2lookup]
LAB_19f1_12a6:
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     ax, word ptr [bp+var_3A]
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [bp+var_vec8], ax
    mov     ax, word ptr [bp+var_hillheight]
    sub     ax, word ptr [bp+var_vec4+2]
    mov     word ptr [bp+var_vec8+2], ax
    mov     ax, word ptr [bp+var_5E]
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [bp+var_vec8+4], ax
    cmp     word ptr [bp+var_hillheight], 0x0
    jnz     LAB_19f1_12ce
    jmp     near ptr LAB_19f1_139e
LAB_19f1_12ce:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     al, byte ptr [bx+0xb]
    cbw
    or      ax, ax
    jz      LAB_19f1_12ec
    cmp     ax, 0x1
    jz      LAB_19f1_12fe
    cmp     ax, 0x2
    jz      LAB_19f1_130a
    cmp     ax, 0x3
    jz      LAB_19f1_1316
    jmp     LAB_19f1_12f5
    db 0x90
LAB_19f1_12ec:
    mov     di, 0x1
    mov     word ptr [bp+var_DA], offset unk_3C0A2
LAB_19f1_12f5:
    mov     word ptr [bp+var_multitileflag], 0x0
    jmp     LAB_19f1_1326
    db 0x90
LAB_19f1_12fe:
    mov     di, 0x2
    mov     word ptr [bp+var_DA], offset unk_3C0A6
    jmp     LAB_19f1_12f5
    db 0x90
LAB_19f1_130a:
    mov     di, 0x2
    mov     word ptr [bp+var_DA], offset unk_3C0AE
    jmp     LAB_19f1_12f5
    db 0x90
LAB_19f1_1316:
    mov     di, 0x4
    mov     word ptr [bp+var_DA], offset unk_3C0B6
    jmp     LAB_19f1_12f5
    db 0x90
LAB_19f1_1322:
    inc     word ptr [bp+var_multitileflag]
LAB_19f1_1326:
    cmp     word ptr [bp+var_multitileflag], di
    jge     LAB_19f1_139e
    mov     bx, word ptr [bp+var_DA]
    add     word ptr [bp+var_DA], 0x2
    mov     ax, word ptr [bx]
    add     ax, word ptr [bp+var_vec8]
    mov     word ptr [currenttransshape], ax
    mov     ax, word ptr [bp+var_vec8+2]
    mov     word ptr [currenttransshape.ts_pos.vy], ax
    mov     bx, word ptr [bp+var_DA]
    add     word ptr [bp+var_DA], 0x2
    mov     ax, word ptr [bx]
    add     ax, word ptr [bp+var_vec8+4]
    mov     word ptr [currenttransshape.ts_pos.vz], ax
    mov     word ptr [currenttransshape.ts_shapeptr], offset (game3dshapes+43*22).shape3d_numverts
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk6
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [currenttransshape.ts_flags], al
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vz], 0x0
    mov     word ptr [currenttransshape.ts_unk], 0x800
    mov     byte ptr [currenttransshape.ts_material], 0x0
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_1322
    jmp     near ptr LAB_19f1_112c
LAB_19f1_139e:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    cmp     byte ptr [bx+0x8], 0x0
    jnz     LAB_19f1_13ab
    jmp     near ptr LAB_19f1_1464
LAB_19f1_13ab:
    mov     al, byte ptr [bx+0x8]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_trkobjectptr], ax
    cmp     byte ptr [bp+var_FC], 0x0
    jz      LAB_19f1_13d0
    mov     bx, ax
    mov     ax, word ptr [bx+0x6]
    jmp     LAB_19f1_13d6
LAB_19f1_13d0:
    mov     bx, word ptr [bp+var_trkobjectptr]
    mov     ax, word ptr [bx+0x4]
LAB_19f1_13d6:
    mov     word ptr [(currenttransshape+1*20).ts_shapeptr], ax
    or      ax, ax
    jnz     LAB_19f1_13e0
    jmp     near ptr LAB_19f1_1464
LAB_19f1_13e0:
    push    si
    push    di
    mov     di, offset (currenttransshape+1*20).ts_pos.vx
    lea     si, [bp+var_vec8]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     word ptr [(currenttransshape+1*20).ts_rotvec.vx], 0x0
    mov     word ptr [(currenttransshape+1*20).ts_rotvec.vy], 0x0
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [(currenttransshape+1*20).ts_rotvec.vz], ax
    cmp     byte ptr [bx+0xb], 0x0
    jz      LAB_19f1_1410
    mov     word ptr [(currenttransshape+1*20).ts_unk], 0x400
    jmp     LAB_19f1_1416
    db 0x90
LAB_19f1_1410:
    mov     word ptr [(currenttransshape+1*20).ts_unk], 0x800
LAB_19f1_1416:
    cmp     byte ptr [bx+0x9], 0x0
    jl      LAB_19f1_1422
    mov     al, byte ptr [bx+0x9]
    jmp     LAB_19f1_1426
    db 0x90
LAB_19f1_1422:
    mov     al, byte ptr [bp+var_E4]
LAB_19f1_1426:
    mov     byte ptr [(currenttransshape+1*20).ts_material], al
    mov     al, byte ptr [bx+0xa]
    or      al, byte ptr [bp+var_122]
    or      al, 0x4
    mov     byte ptr [(currenttransshape+1*20).ts_flags], al
    test    byte ptr [(currenttransshape+1*20).ts_flags], 0x1
    jz      LAB_19f1_145a
    mov     word ptr [(currenttransshape+1*20).ts_rectptr], offset rect_unk2
    mov     ax, offset (currenttransshape+1*20).ts_pos.vx
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_1464
    jmp     near ptr LAB_19f1_112c
LAB_19f1_145a:
    mov     word ptr [(currenttransshape+1*20).ts_rectptr], offset rect_unk6
    mov     byte ptr [bp+var_4E], 0x1
LAB_19f1_1464:
    cmp     byte ptr [bp+var_FC], 0x0
    jz      LAB_19f1_1474
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x6]
    jmp     LAB_19f1_147b
LAB_19f1_1474:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
LAB_19f1_147b:
    mov     word ptr [currenttransshape.ts_shapeptr], ax
    push    si
    push    di
    mov     di, offset currenttransshape
    lea     si, [bp+var_vec8]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     word ptr [currenttransshape.ts_rotvec.vx], 0x0
    mov     word ptr [currenttransshape.ts_rotvec.vy], 0x0
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [currenttransshape.ts_rotvec.vz], ax
    cmp     byte ptr [bx+0xb], 0x0
    jz      LAB_19f1_14ae
    mov     word ptr [currenttransshape.ts_unk], 0x400
    jmp     LAB_19f1_14b4
    db 0x90
LAB_19f1_14ae:
    mov     word ptr [currenttransshape.ts_unk], 0x800
LAB_19f1_14b4:
    mov     al, byte ptr [bx+0xa]
    or      al, byte ptr [bp+var_122]
    or      al, 0x4
    mov     byte ptr [currenttransshape.ts_flags], al
    cmp     byte ptr [bx+0x9], 0x0
    jl      LAB_19f1_14cc
    mov     al, byte ptr [bx+0x9]
    jmp     LAB_19f1_14d0
    db 0x90
LAB_19f1_14cc:
    mov     al, byte ptr [bp+var_E4]
LAB_19f1_14d0:
    mov     byte ptr [currenttransshape.ts_material], al
    test    byte ptr [bx+0xa], 0x1
    jz      LAB_19f1_14f8
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk2
    mov     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_155a
    jmp     near ptr LAB_19f1_112c
    db 0x90
LAB_19f1_14f8:
    mov     word ptr [currenttransshape.ts_rectptr], offset rect_unk6
    sub     ax, ax
    push    ax
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
    cmp     byte ptr [bp+var_4E], 0x0
    jz      LAB_19f1_1539
    mov     byte ptr [bp+var_4E], 0x0
    sub     ax, ax
    push    ax
    mov     ax, 0xf800
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
    cmp     word ptr [bp+var_6C], 0x0
    jz      LAB_19f1_152c
    mov     word ptr [bp+var_6C], 0xfc00
LAB_19f1_152c:
    cmp     word ptr [bp+var_A4], 0x0
    jz      LAB_19f1_1539
    sub     word ptr [bp+var_A4], 0x400
LAB_19f1_1539:
    mov     al, byte ptr [startcol2]
    cmp     byte ptr [bp+var_pos2lookup], al
    jnz     LAB_19f1_1554
    mov     al, byte ptr [startrow2]
    cmp     byte ptr [bp+var_poslookup], al
    jnz     LAB_19f1_1554
    mov     word ptr [bp+var_12A], 0x0
    jmp     LAB_19f1_155a
    db 0x90
LAB_19f1_1554:
    mov     word ptr [bp+var_12A], 0xffff
LAB_19f1_155a:
    mov     al, byte ptr [bp+var_poslookup]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     bx, word ptr [bx+trackrows]
    mov     al, byte ptr [bp+var_pos2lookup]
    cbw
    add     bx, ax
    add     bx, word ptr [trackdata19]
    mov     es, word ptr [trackdata19+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+var_4C], al
    cmp     al, 0xff
    jnz     LAB_19f1_1583
    jmp     near ptr LAB_19f1_181e
LAB_19f1_1583:
    cbw
    mov     bx, ax
    cmp     byte ptr [bx+state.field_3FA], 0x0
    jnz     LAB_19f1_1590
    jmp     near ptr LAB_19f1_1716
LAB_19f1_1590:
    cmp     byte ptr [state.field_42A], 0x0
    jnz     LAB_19f1_159a
    jmp     near ptr LAB_19f1_181e
LAB_19f1_159a:
    sub     di, di
LAB_19f1_159c:
    mov     ax, di
    shl     ax, 0x1
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    cmp     word ptr [bx+state.field_38E], 0x0
    jnz     LAB_19f1_15b0
    jmp     near ptr LAB_19f1_170a
LAB_19f1_15b0:
    mov     al, byte ptr [bp+var_4C]
    cbw
    add     ax, 0x2
    mov     cl, byte ptr [di+state.field_443]
    sub     ch, ch
    cmp     ax, cx
    jz      LAB_19f1_15c4
    jmp     near ptr LAB_19f1_170a
LAB_19f1_15c4:
    mov     al, byte ptr [di+state.field_42B]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes3
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     ax, di
    shl     ax, 0x1
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     ax, word ptr [bx+state]
    mov     dx, word ptr [bx+state.game_longs1+2]
    mov     cl, 0x6
LAB_19f1_15f3:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_15f3
    mov     cx, ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    add     cx, word ptr es:[bx]
    sub     cx, word ptr [bp+var_vec4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx], cx
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs2]
    mov     dx, word ptr [bx+state.game_longs2+2]
    mov     cl, 0x6
LAB_19f1_162b:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_162b
    mov     cx, ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    add     cx, word ptr es:[bx+0x2]
    sub     cx, word ptr [bp+var_vec4+2]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x2], cx
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs3]
    mov     dx, word ptr [bx+state.game_longs3+2]
    mov     cl, 0x6
LAB_19f1_1665:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1665
    mov     cx, ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    add     cx, word ptr es:[bx+0x4]
    sub     cx, word ptr [bp+var_vec4+4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x4], cx
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk6
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [bx+0x12], al
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_2FE]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xa], ax
    mov     ax, di
    shl     ax, 0x1
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    mov     ax, word ptr [bx+state.field_32E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xc], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_35E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x400
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x13], 0x0
    sub     ax, ax
    push    ax
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_170a:
    inc     di
    cmp     di, 0x18
    jge     LAB_19f1_1713
    jmp     near ptr LAB_19f1_159c
LAB_19f1_1713:
    jmp     near ptr LAB_19f1_181e
LAB_19f1_1716:
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    add     bx, word ptr [trackdata23]
    mov     es, word ptr [trackdata23+2]
    mov     al, byte ptr es:[bx]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset (trkObjectList+212*14).ss_trkObjInfoPtr
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    mov     ax, word ptr es:[bx]
    sub     ax, word ptr [bp+var_vec4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx], ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    mov     ax, word ptr es:[bx+0x2]
    sub     ax, word ptr [bp+var_vec4+2]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x2], ax
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td10_track_check_rel]
    mov     es, word ptr [td10_track_check_rel+2]
    mov     ax, word ptr es:[bx+0x4]
    sub     ax, word ptr [bp+var_vec4+4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x4], ax
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk6
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_122]
    or      al, 0x4
    mov     byte ptr [bx+0x12], al
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xa], 0x0
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xc], 0x0
    mov     al, byte ptr [bp+var_4C]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     bx, word ptr [td08_direction_related]
    mov     es, word ptr [td08_direction_related+2]
    mov     ax, word ptr es:[bx]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x64
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x13], 0x0
    sub     ax, ax
    push    ax
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
    jmp     LAB_19f1_181e
LAB_19f1_180e:
    mov     al, byte ptr [bp+var_pos2lookup]
    mov     byte ptr [bp+var_pos2lookupadjust], al
    mov     al, byte ptr [bp+var_poslookup]
    mov     byte ptr [bp+var_poslookupadjust], al
LAB_19f1_181e:
    mov     al, byte ptr [bp+var_pos2lookup]
    cmp     byte ptr [bp+var_3C], al
    jz      LAB_19f1_1833
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cmp     byte ptr [bp+var_3C], al
    jz      LAB_19f1_1833
    jmp     near ptr LAB_19f1_1aca
LAB_19f1_1833:
    mov     al, byte ptr [bp+var_poslookup]
    cmp     byte ptr [bp+var_60], al
    jz      LAB_19f1_1848
    mov     al, byte ptr [bp+var_poslookupadjust]
    cmp     byte ptr [bp+var_60], al
    jz      LAB_19f1_1848
    jmp     near ptr LAB_19f1_1aca
LAB_19f1_1848:
    cmp     byte ptr [state.field_42A], 0x0
    jnz     LAB_19f1_1852
    jmp     near ptr LAB_19f1_198f
LAB_19f1_1852:
    sub     di, di
LAB_19f1_1854:
    mov     ax, di
    shl     ax, 0x1
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    cmp     word ptr [bx+state.field_38E], 0x0
    jnz     LAB_19f1_1868
    jmp     near ptr LAB_19f1_1986
LAB_19f1_1868:
    cmp     byte ptr [di+state.field_443], 0x0
    jz      LAB_19f1_1872
    jmp     near ptr LAB_19f1_1986
LAB_19f1_1872:
    mov     al, byte ptr [di+state.field_42B]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes3
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     ax, di
    shl     ax, 0x1
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     ax, word ptr [bx+state]
    mov     dx, word ptr [bx+state.game_longs1+2]
    add     ax, word ptr [state.playerstate.car_posWorld1.lx]
    adc     dx, word ptr [state.playerstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_18a9:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_18a9
    sub     ax, word ptr [bp+var_vec4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx], ax
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs2]
    mov     dx, word ptr [bx+state.game_longs2+2]
    add     ax, word ptr [state.playerstate.car_posWorld1.ly]
    adc     dx, word ptr [state.playerstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_18d0:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_18d0
    sub     ax, word ptr [bp+var_vec4+2]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x2], ax
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs3]
    mov     dx, word ptr [bx+state.game_longs3+2]
    add     ax, word ptr [state.playerstate.car_posWorld1.lz]
    adc     dx, word ptr [state.playerstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_18f8:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_18f8
    sub     ax, word ptr [bp+var_vec4+4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x4], ax
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk6
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [bx+0x12], al
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_2FE]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xa], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_32E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xc], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_35E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x400
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [gameconfig.game_playermaterial]
    mov     byte ptr [bx+0x13], al
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_6C]
    and     ax, word ptr [bp+var_12A]
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_1986:
    inc     di
    cmp     di, 0x18
    jge     LAB_19f1_198f
    jmp     near ptr LAB_19f1_1854
LAB_19f1_198f:
    mov     word ptr [bp+var_trkobject_ptr], offset (trkObjectList+2*14).ss_trkObjInfoPtr
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_posWorld1.lx]
    mov     dx, word ptr [state.playerstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_19a2:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_19a2
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [bx], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_posWorld1.ly]
    mov     dx, word ptr [state.playerstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_19bc:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_19bc
    sub     ax, word ptr [bp+var_vec4+2]
    mov     word ptr [bx+0x2], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_posWorld1.lz]
    mov     dx, word ptr [state.playerstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_19d7:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_19d7
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [bx+0x4], ax
    cmp     byte ptr [bp+var_FC], 0x0
    jnz     LAB_19f1_19f3
    cmp     byte ptr [detail_level], 0x2
    jbe     LAB_19f1_1a04
LAB_19f1_19f3:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x6]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    jmp     LAB_19f1_1a3a
    db 0x90
LAB_19f1_1a04:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     ax, offset carshapevec
    push    ax
    mov     ax, offset carshapevecs
    push    ax
    mov     ax, offset word_443E8
    push    ax
    mov     ax, offset state.playerstate.car_rc2
    push    ax
    push    word ptr [state.playerstate.car_steeringAngle]
    mov     ax, word ptr [(game3dshapes+126*22).shape3d_verts]
    mov     dx, word ptr [(game3dshapes+126*22).shape3d_verts+2]
    add     ax, 0x30
    push    dx
    push    ax
    call    far ptr sub_204AE
    add     sp, 0xe
LAB_19f1_1a3a:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_1a54
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk12
LAB_19f1_1a4a:
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x12], 0xc
    jmp     LAB_19f1_1a80
LAB_19f1_1a54:
    cmp     byte ptr [state.playerstate.car_crashBmpFlag], 0x1
    jnz     LAB_19f1_1a78
    push    si
    push    di
    lea     di, [bp+var_rect]
    mov     si, offset cliprect_unk
    push    ss
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     bx, word ptr [curtransshape_ptr]
    lea     ax, [bp+var_rect]
    mov     word ptr [bx+0x8], ax
    jmp     LAB_19f1_1a4a
    db 0x90
LAB_19f1_1a78:
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x12], 0x4
LAB_19f1_1a80:
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_rotate.vz]
    neg     ax
    mov     word ptr [bx+0xa], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_rotate.vy]
    neg     ax
    mov     word ptr [bx+0xc], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.playerstate.car_rotate.vx]
    neg     ax
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x12c
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [gameconfig.game_playermaterial]
    mov     byte ptr [bx+0x13], al
    mov     ax, 0x2
    push    ax
    mov     ax, word ptr [bp+var_6C]
    and     ax, word ptr [bp+var_12A]
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_1aca:
    mov     al, byte ptr [bp+var_pos2lookup]
    cmp     byte ptr [bp+var_4A], al
    jz      LAB_19f1_1adf
    mov     al, byte ptr [bp+var_pos2lookupadjust]
    cmp     byte ptr [bp+var_4A], al
    jz      LAB_19f1_1adf
    jmp     near ptr LAB_19f1_1d79
LAB_19f1_1adf:
    mov     al, byte ptr [bp+var_poslookup]
    cmp     byte ptr [bp+var_6E], al
    jz      LAB_19f1_1af4
    mov     al, byte ptr [bp+var_poslookupadjust]
    cmp     byte ptr [bp+var_6E], al
    jz      LAB_19f1_1af4
    jmp     near ptr LAB_19f1_1d79
LAB_19f1_1af4:
    cmp     byte ptr [state.field_42A], 0x0
    jnz     LAB_19f1_1afe
    jmp     near ptr LAB_19f1_1c3c
LAB_19f1_1afe:
    sub     di, di
LAB_19f1_1b00:
    mov     ax, di
    shl     ax, 0x1
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    cmp     word ptr [bx+state.field_38E], 0x0
    jnz     LAB_19f1_1b14
    jmp     near ptr LAB_19f1_1c33
LAB_19f1_1b14:
    cmp     byte ptr [di+state.field_443], 0x1
    jz      LAB_19f1_1b1e
    jmp     near ptr LAB_19f1_1c33
LAB_19f1_1b1e:
    mov     al, byte ptr [di+state.field_42B]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes3
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     ax, di
    shl     ax, 0x1
    shl     ax, 0x1
    mov     word ptr [bp+var_lastposlookupw], ax
    mov     bx, ax
    mov     ax, word ptr [bx+state]
    mov     dx, word ptr [bx+state.game_longs1+2]
    add     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    adc     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_1b55:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1b55
    sub     ax, word ptr [bp+var_vec4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx], ax
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs2]
    mov     dx, word ptr [bx+state.game_longs2+2]
    add     ax, word ptr [state.opponentstate.car_posWorld1.ly]
    adc     dx, word ptr [state.opponentstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_1b7c:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1b7c
    sub     ax, word ptr [bp+var_vec4+2]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x2], ax
    mov     bx, word ptr [bp+var_lastposlookupw]
    mov     ax, word ptr [bx+state.game_longs3]
    mov     dx, word ptr [bx+state.game_longs3+2]
    add     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    adc     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_1ba4:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1ba4
    sub     ax, word ptr [bp+var_vec4+4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x4], ax
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk6
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_122]
    or      al, 0x5
    mov     byte ptr [bx+0x12], al
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_2FE]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xa], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_32E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xc], ax
    mov     bx, word ptr [bp+var_lastpos2lookup]
    mov     ax, word ptr [bx+state.field_35E]
    neg     ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x400
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [gameconfig.game_opponentmaterial]
    mov     byte ptr [bx+0x13], al
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_A4]
    and     ax, word ptr [bp+var_12A]
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_1c33:
    inc     di
    cmp     di, 0x18
    jge     LAB_19f1_1c3c
    jmp     near ptr LAB_19f1_1b00
LAB_19f1_1c3c:
    mov     word ptr [bp+var_trkobject_ptr], offset (trkObjectList+3*14).ss_trkObjInfoPtr
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_1c4f:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1c4f
    sub     ax, word ptr [bp+var_vec4]
    mov     word ptr [bx], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_posWorld1.ly]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_1c69:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1c69
    sub     ax, word ptr [bp+var_vec4+2]
    mov     word ptr [bx+0x2], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_1c84:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_1c84
    sub     ax, word ptr [bp+var_vec4+4]
    mov     word ptr [bx+0x4], ax
    cmp     byte ptr [bp+var_FC], 0x0
    jnz     LAB_19f1_1ca0
    cmp     byte ptr [detail_level], 0x2
    jbe     LAB_19f1_1cb0
LAB_19f1_1ca0:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x6]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    jmp     LAB_19f1_1ce6
LAB_19f1_1cb0:
    mov     bx, word ptr [bp+var_trkobject_ptr]
    mov     ax, word ptr [bx+0x4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], ax
    mov     ax, offset oppcarshapevec
    push    ax
    mov     ax, offset oppcarshapevecs
    push    ax
    mov     ax, offset word_4448A
    push    ax
    mov     ax, offset state.opponentstate.car_rc2
    push    ax
    push    word ptr [state.opponentstate.car_steeringAngle]
    mov     ax, word ptr [(game3dshapes+127*22).shape3d_verts]
    mov     dx, word ptr [(game3dshapes+127*22).shape3d_verts+2]
    add     ax, 0x30
    push    dx
    push    ax
    call    far ptr sub_204AE
    add     sp, 0xe
LAB_19f1_1ce6:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_1d00
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk15
LAB_19f1_1cf6:
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x12], 0xc
    jmp     LAB_19f1_1d2e
LAB_19f1_1d00:
    cmp     byte ptr [state.opponentstate.car_crashBmpFlag], 0x1
    jnz     LAB_19f1_1d26
    push    si
    push    di
    lea     di, [bp+var_rect2]
    mov     si, offset cliprect_unk
    push    ss
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     bx, word ptr [curtransshape_ptr]
    lea     ax, [bp+var_rect2]
    mov     word ptr [bx+0x8], ax
    jmp     LAB_19f1_1cf6
    db 0x90
LAB_19f1_1d26:
    mov     bx, word ptr [curtransshape_ptr]
    mov     byte ptr [bx+0x12], 0x4
LAB_19f1_1d2e:
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_rotate.vz]
    neg     ax
    mov     word ptr [bx+0xa], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_rotate.vy]
    neg     ax
    mov     word ptr [bx+0xc], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [state.opponentstate.car_rotate.vx]
    neg     ax
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x12c
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [gameconfig.game_opponentmaterial]
    mov     byte ptr [bx+0x13], al
    mov     ax, 0x3
    push    ax
    mov     ax, word ptr [bp+var_A4]
    and     ax, word ptr [bp+var_12A]
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_1d79:
    cmp     byte ptr [state.game_inputmode], 0x0
    jz      LAB_19f1_1d83
    jmp     near ptr LAB_19f1_1f9a
LAB_19f1_1d83:
    mov     al, byte ptr [startcol2]
    cmp     byte ptr [bp+var_pos2lookup], al
    jz      LAB_19f1_1d95
    cmp     byte ptr [bp+var_pos2lookupadjust], al
    jz      LAB_19f1_1d95
    jmp     near ptr LAB_19f1_1f9a
LAB_19f1_1d95:
    mov     al, byte ptr [startrow2]
    cmp     byte ptr [bp+var_poslookup], al
    jz      LAB_19f1_1da7
    cmp     byte ptr [bp+var_poslookupadjust], al
    jz      LAB_19f1_1da7
    jmp     near ptr LAB_19f1_1f9a
LAB_19f1_1da7:
    mov     ax, 0x24
    push    ax
    push    word ptr [g_truckdoor]
    call    far ptr int_cos
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     word ptr [bp+var_multitileflag], ax
    mov     ax, 0x24
    push    ax
    push    word ptr [g_truckdoor]
    call    far ptr int_sin
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    add     ax, 0x38
    mov     word ptr [bp+var_counter], ax
    mov     ax, word ptr [(game3dshapes+111*22).shape3d_verts]
    mov     dx, word ptr [(game3dshapes+111*22).shape3d_verts+2]
    add     ax, 0x30
    mov     word ptr [bp+var_108], ax
    mov     word ptr [bp+var_108+2], dx
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_multitileflag]
    sub     ax, 0x24
    mov     word ptr es:[bx], ax
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_multitileflag]
    sub     ax, 0x24
    mov     word ptr es:[bx+0x6], ax
    les     bx, [bp+var_108]
    mov     ax, 0x24
    sub     ax, word ptr [bp+var_multitileflag]
    mov     word ptr es:[bx+0xc], ax
    les     bx, [bp+var_108]
    mov     ax, 0x24
    sub     ax, word ptr [bp+var_multitileflag]
    mov     word ptr es:[bx+0x12], ax
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_counter]
    mov     word ptr es:[bx+0x4], ax
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_counter]
    mov     word ptr es:[bx+0xa], ax
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_counter]
    mov     word ptr es:[bx+0x10], ax
    les     bx, [bp+var_108]
    mov     ax, word ptr [bp+var_counter]
    mov     word ptr es:[bx+0x16], ax
    mov     ax, 0x24
    push    ax
    mov     ax, word ptr [track_angle]
    add     ah, 0x1
    push    ax
    call    far ptr int_sin
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     cx, 0x1b6
    push    cx
    mov     cx, word ptr [track_angle]
    add     ch, 0x2
    push    cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    call    far ptr int_sin
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     cx, ax
    mov     al, byte ptr [startcol2]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     cx, word ptr [bx+trackcenterpos2]
    add     cx, word ptr [bp+var_lastpos2lookup]
    sub     cx, word ptr [bp+var_vec4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx], cx
    mov     al, byte ptr [hillFlag]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+hillHeightConsts]
    sub     ax, word ptr [bp+var_vec4+2]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x2], ax
    mov     ax, 0x24
    push    ax
    mov     ax, word ptr [track_angle]
    add     ah, 0x1
    push    ax
    call    far ptr int_cos
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     cx, 0x1b6
    push    cx
    mov     cx, word ptr [track_angle]
    add     ch, 0x2
    push    cx
    mov     word ptr [bp+var_lastpos2lookup], ax
    call    far ptr int_cos
    add     sp, 0x2
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     cx, ax
    mov     al, byte ptr [startrow2]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    add     cx, word ptr [bx+trackcenterpos]
    add     cx, word ptr [bp+var_lastpos2lookup]
    sub     cx, word ptr [bp+var_vec4+4]
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x4], cx
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x6], offset (game3dshapes+111*22).shape3d_numverts
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x8], offset rect_unk6
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_122]
    or      al, 0x4
    mov     byte ptr [bx+0x12], al
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xa], 0x0
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0xc], 0x0
    mov     bx, word ptr [curtransshape_ptr]
    mov     ax, word ptr [track_angle]
    mov     word ptr [bx+0xe], ax
    mov     bx, word ptr [curtransshape_ptr]
    mov     word ptr [bx+0x10], 0x400
    mov     ax, word ptr [g_truckdoor]
    mov     cl, 0x6
    sar     ax, cl
    mov     word ptr [bp+var_multitileflag], ax
    cmp     ax, 0x3
    jle     LAB_19f1_1f7d
    mov     word ptr [bp+var_multitileflag], 0x3
LAB_19f1_1f7d:
    mov     bx, word ptr [curtransshape_ptr]
    mov     al, byte ptr [bp+var_multitileflag]
    mov     byte ptr [bx+0x13], al
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_12A]
    and     ax, 0xf800
    push    ax
    push    cs
    call    near ptr transformed_shape_add_for_sort
    add     sp, 0x4
LAB_19f1_1f9a:
    cmp     byte ptr [transformedshape_counter], 0x0
    jnz     LAB_19f1_1fa4
    jmp     near ptr LAB_19f1_205c
LAB_19f1_1fa4:
    cmp     byte ptr [transformedshape_counter], 0x1
    jle     LAB_19f1_1fc0
    mov     ax, offset transformedshape_indices
    push    ax
    mov     ax, offset transformedshape_zarray
    push    ax
    mov     al, byte ptr [transformedshape_counter]
    cbw
    push    ax
    call    far ptr heapsort_by_order
    add     sp, 0x6
LAB_19f1_1fc0:
    mov     word ptr [bp+var_multitileflag], 0x0
    jmp     LAB_19f1_2028
LAB_19f1_1fc8:
    cmp     byte ptr [state.playerstate.car_is_braking], 0x0
    jnz     LAB_19f1_1ff9
LAB_19f1_1fcf:
    mov     byte ptr [backlights_paint_override], 0x2e
LAB_19f1_1fd4:
    mov     ax, 0x14
    imul    di
    add     ax, offset currenttransshape
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cbw
    mov     word ptr [bp+var_transformresult], ax
    or      ax, ax
    jle     LAB_19f1_2000
    jmp     near ptr LAB_19f1_112c
    db 0x90
LAB_19f1_1ff2:
    cmp     byte ptr [state.opponentstate.car_is_braking], 0x0
    jz      LAB_19f1_1fcf
LAB_19f1_1ff9:
    mov     byte ptr [backlights_paint_override], 0x2f
    jmp     LAB_19f1_1fd4
LAB_19f1_2000:
    cmp     word ptr [bp+var_transformresult], 0x0
    jnz     LAB_19f1_2024
    mov     al, byte ptr [di+transformedshape_arg2array]
    cbw
    cmp     ax, 0x2
    jz      LAB_19f1_2018
    cmp     ax, 0x3
    jz      LAB_19f1_204e
    jmp     LAB_19f1_2024
LAB_19f1_2018:
    cmp     byte ptr [state.playerstate.car_crashBmpFlag], 0x1
    jnz     LAB_19f1_2024
    mov     byte ptr [bp+var_DC], 0x1
LAB_19f1_2024:
    inc     word ptr [bp+var_multitileflag]
LAB_19f1_2028:
    mov     al, byte ptr [transformedshape_counter]
    cbw
    cmp     word ptr [bp+var_multitileflag], ax
    jge     LAB_19f1_205c
    mov     bx, word ptr [bp+var_multitileflag]
    shl     bx, 0x1
    mov     di, word ptr [bx+transformedshape_indices]
    mov     al, byte ptr [di+transformedshape_arg2array]
    cbw
    cmp     ax, 0x2
    jz      LAB_19f1_1fc8
    cmp     ax, 0x3
    jz      LAB_19f1_1ff2
    jmp     LAB_19f1_1fd4
    db 0x90
LAB_19f1_204e:
    cmp     byte ptr [state.opponentstate.car_crashBmpFlag], 0x1
    jnz     LAB_19f1_2024
    mov     byte ptr [bp+local_dd], 0x1
    jmp     LAB_19f1_2024
LAB_19f1_205c:
    inc     si
LAB_19f1_205d:
    cmp     si, 0x17
    jl      LAB_19f1_2065
    jmp     near ptr LAB_19f1_112c
LAB_19f1_2065:
    cmp     byte ptr [bp+si-0x32], 0x0
    jnz     LAB_19f1_205c
    mov     al, byte ptr [bp+si+0xff7a]
    mov     byte ptr [bp+var_pos2lookup], al
    mov     al, byte ptr [bp+si+0xff2c]
    mov     byte ptr [bp+var_poslookup], al
    mov     al, byte ptr [bp+si+0xfeb4]
    mov     byte ptr [bp+elem_map_value], al
    mov     al, byte ptr [bp+si-0x1a]
    mov     byte ptr [bp+terr_map_value], al
    mov     al, byte ptr [bp+si+0xff44]
    mov     byte ptr [bp+var_FC], al
    mov     word ptr [bp+var_12A], 0x0
    cmp     byte ptr [bp+elem_map_value], 0x0
    jnz     LAB_19f1_20a0
    jmp     near ptr LAB_19f1_0e3a
LAB_19f1_20a0:
    mov     al, byte ptr [bp+elem_map_value]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_trkobject_ptr], ax
    mov     bx, ax
    mov     al, byte ptr [bx+0xb]
    cbw
    or      ax, ax
    jnz     LAB_19f1_20c5
    jmp     near ptr LAB_19f1_0e08
LAB_19f1_20c5:
    cmp     ax, 0x1
    jnz     LAB_19f1_20cd
    jmp     near ptr LAB_19f1_0e16
LAB_19f1_20cd:
    cmp     ax, 0x2
    jnz     LAB_19f1_20d5
    jmp     near ptr LAB_19f1_0e24
LAB_19f1_20d5:
    cmp     ax, 0x3
    jnz     LAB_19f1_20dd
    jmp     near ptr LAB_19f1_0e2c
LAB_19f1_20dd:
    jmp     near ptr LAB_19f1_0e45
LAB_19f1_20e0:
    mov     word ptr [bp+var_rectptr], offset rect_unk15
    jmp     LAB_19f1_20f9
    db 0x90
LAB_19f1_20e8:
    or      si, si
    jnz     LAB_19f1_20f2
    lea     ax, [bp+var_rect]
    jmp     LAB_19f1_20f6
    db 0x90
LAB_19f1_20f2:
    lea     ax, [bp+var_rect2]
LAB_19f1_20f6:
    mov     word ptr [bp+var_rectptr], ax
LAB_19f1_20f9:
    push    word ptr [bp+cliprect]
    push    word ptr [bp+var_rectptr]
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jz      LAB_19f1_210e
    jmp     near ptr LAB_19f1_21b1
LAB_19f1_210e:
    mov     bx, word ptr [bp+var_rectptr]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    mov     bx, word ptr [bp+var_rectptr]
    mov     ax, word ptr [bx+0x2]
    add     ax, word ptr [bx]
    sar     ax, 0x1
    mov     word ptr [bp+var_vec6], ax
    mov     ax, word ptr [bx+0x4]
    add     ax, word ptr [bx+0x6]
    sar     ax, 0x1
    mov     word ptr [bp+var_vec6+2], ax
    mov     ax, word ptr [bx+0x2]
    sub     ax, word ptr [bx]
    mov     word ptr [bp+var_multitileflag], ax
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    mov     word ptr [bp+var_counter], ax
    mov     ax, word ptr [bp+var_multitileflag]
    cmp     word ptr [bp+var_counter], ax
    jle     LAB_19f1_2160
    mov     ax, word ptr [bp+var_counter]
    mov     word ptr [bp+var_multitileflag], ax
LAB_19f1_2160:
    mov     ax, word ptr [state.game_frame]
    shr     ax, 0x1
    shr     ax, 0x1
    sub     dx, dx
    mov     cx, 0x3
    div     cx
    mov     di, dx
    mov     bx, di
    shl     bx, 0x1
    mov     ax, word ptr [bx+sdgame2_widths]   ; lookup width of explotion shape
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+var_multitileflag]
    cwd
    mov     dh, dl
    mov     dl, ah
    mov     ah, al
    sub     al, al
    push    dx
    push    ax
    call    far ptr __aFldiv
    mov     word ptr [bp+var_counter], ax
    push    word ptr [bp+var_vec6+2]
    push    word ptr [bp+var_vec6]
    mov     bx, di
    shl     bx, 0x1
    shl     bx, 0x1
    push    word ptr [bx+sdgame2shapes+2]
    push    word ptr [bx+sdgame2shapes]        ; loops up one of the three explotion anim shapes
    push    ax
    call    far ptr shape_op_explosion
    add     sp, 0xa
LAB_19f1_21b1:
    inc     si
LAB_19f1_21b2:
    cmp     si, 0x2
    jge     LAB_19f1_21d8
    cmp     byte ptr [bp+si+0xff24], 0x0
    jz      LAB_19f1_21b1
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_21c8
    jmp     near ptr LAB_19f1_20e8
LAB_19f1_21c8:
    or      si, si
    jz      LAB_19f1_21cf
    jmp     near ptr LAB_19f1_20e0
LAB_19f1_21cf:
    mov     word ptr [bp+var_rectptr], offset rect_unk12
    jmp     near ptr LAB_19f1_20f9
    db 0x90
LAB_19f1_21d8:
    mov     bx, word ptr [bp+cliprect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    cmp     byte ptr [cameramode], 0x0
    jz      LAB_19f1_21fa
    jmp     near ptr LAB_19f1_22b6
LAB_19f1_21fa:
    cmp     byte ptr [followOpponentFlag], 0x0
    jz      LAB_19f1_220e
    mov     word ptr [bp+var_stateptr], offset state.opponentstate.car_posWorld1.lx
    mov     si, word ptr [state.game_oEndFrame]
    jmp     LAB_19f1_2218
    db 0x90
LAB_19f1_220e:
    mov     word ptr [bp+var_stateptr], offset state.playerstate.car_posWorld1.lx
    mov     si, word ptr [state.game_pEndFrame]
LAB_19f1_2218:
    mov     bx, word ptr [bp+var_stateptr]
    cmp     byte ptr [bx+0xc9], 0x1
    jnz     LAB_19f1_226c
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_2252
    mov     ax, offset rect_unk
    push    ax
    push    ax
    mov     bx, word ptr [bp+cliprect]
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    push    ax
    push    word ptr [bx+0x4]
    mov     ax, word ptr [state.game_frame]
    sub     ax, si
    push    ax
    push    cs
    call    near ptr init_crak
LAB_19f1_2246:
    add     sp, 0x6
    push    ax
    call    far ptr rect_union
    jmp     LAB_19f1_22b3
    db 0x90
LAB_19f1_2252:
    mov     bx, word ptr [bp+cliprect]
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    push    ax
    push    word ptr [bx+0x4]
    mov     ax, word ptr [state.game_frame]
    sub     ax, si
    push    ax
    push    cs
    call    near ptr init_crak
    jmp     LAB_19f1_22b3
    db 0x90
LAB_19f1_226c:
    mov     bx, word ptr [bp+var_stateptr]
    cmp     byte ptr [bx+0xc9], 0x2
    jnz     LAB_19f1_22b6
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_229c
    mov     ax, offset rect_unk
    push    ax
    push    ax
    mov     bx, word ptr [bp+cliprect]
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    push    ax
    push    word ptr [bx+0x4]
    mov     ax, word ptr [state.game_frame]
    sub     ax, si
    push    ax
    push    cs
    call    near ptr do_sinking
    jmp     LAB_19f1_2246
LAB_19f1_229c:
    mov     bx, word ptr [bp+cliprect]
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    push    ax
    push    word ptr [bx+0x4]
    mov     ax, word ptr [state.game_frame]
    sub     ax, si
    push    ax
    push    cs
    call    near ptr do_sinking
LAB_19f1_22b3:
    add     sp, 0x6
LAB_19f1_22b6:
    cmp     byte ptr [game_replay_mode], 0x0
    jz      LAB_19f1_22c0
    jmp     near ptr LAB_19f1_234b
LAB_19f1_22c0:
    cmp     byte ptr [state.game_inputmode], 0x0
    jnz     LAB_19f1_22ca
    jmp     near ptr LAB_19f1_234b
LAB_19f1_22ca:
    sub     ax, ax
    push    ax                                 ; int
    mov     ax, word ptr [elapsed_time1]
    add     ax, word ptr [elapsed_time2]
    push    ax
    mov     ax, offset g_res_id
    push    ax                                 ; char *
    call    far ptr format_frame_as_string     ; prints elapsed time (unless in pause/replay, or some unknown state)
    add     sp, 0x6
    push    word ptr [fontledresptr+2]
    push    word ptr [fontledresptr]
    call    far ptr font_set_fontdef2
    add     sp, 0x4
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_2328
    mov     ax, offset rect_unk11
    push    ax
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, word ptr [roofbmpheight]
    add     ax, 0x2
    push    ax
    mov     ax, 0x8c
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    jmp     LAB_19f1_2346
    db 0x90
    db 0x90
LAB_19f1_2328:
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, word ptr [roofbmpheight]
    add     ax, 0x2
    push    ax
    mov     ax, 0x8c
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
LAB_19f1_2346:
    call    far ptr font_set_fontdef
LAB_19f1_234b:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_2355
    jmp     near ptr LAB_19f1_23e8
LAB_19f1_2355:
    mov     ax, offset rect_unk
    push    ax
    push    ax
    push    cs
    call    near ptr draw_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    cmp     word ptr [bp+var_132], 0x0
    jz      LAB_19f1_239e
    mov     ax, word ptr [bp+cliprect]
    push    si
    push    di
    mov     di, offset rect_unk
    mov     si, ax
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     si, 0x1
LAB_19f1_2383:
    mov     bx, si
    mov     cl, 0x3
    shl     bx, cl
    push    si
    push    di
    lea     di, [bx+rect_unk]
    mov     si, offset cliprect_unk
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_2383
LAB_19f1_239e:
    sub     si, si
LAB_19f1_23a0:
    mov     ax, si
    mov     cl, 0x3
    shl     ax, cl
    mov     word ptr [bp+var_lastpos2lookup], ax
    mov     bx, ax
    lea     ax, [bx+rect_unk]
    mov     bx, word ptr [bp+var_lastpos2lookup]
    add     bx, word ptr [rectptr_unk]
    push    si
    push    di
    mov     di, bx
    mov     si, ax
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_23a0
    mov     al, byte ptr [bp+unk]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bp+var_angY]
    mov     word ptr [bx+word_449FC], ax
    mov     ax, word ptr [bp+var_angY]
    mov     word ptr [word_463D6], ax
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
    db 0x90
LAB_19f1_23e8:
    push    cs
    call    near ptr draw_ingame_text
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
update_frame_asm_ endp

; void __cdecl16far skybox_op_helper2(RECTANGLE * rect, int unk_x, int height)
skybox_op_helper2_asm_ proc far
    rect       = word ptr    6
    unk_x      = word ptr    8
    height     = word ptr   10

    push    bp
    mov     bp, sp
    sub     sp, 0x4
    push    di
    push    si
    cmp     byte ptr [detail_level], 0x4
    jz      LAB_19f1_2410
    mov     si, word ptr [bp+height]
    mov     bx, word ptr [bp+rect]
    sub     si, word ptr [bx+0x4]
    sub     si, word ptr [skybox_current]
    jmp     LAB_19f1_2419
LAB_19f1_2410:
    mov     si, word ptr [bp+height]
    mov     bx, word ptr [bp+rect]
    sub     si, word ptr [bx+0x4]
LAB_19f1_2419:
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    cmp     ax, si
    jge     LAB_19f1_2429
    mov     si, word ptr [bx+0x6]
    sub     si, word ptr [bx+0x4]
LAB_19f1_2429:
    or      si, si
    jle     LAB_19f1_244f
    mov     ax, word ptr [bx+0x4]
    add     ax, si
    push    ax
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_sky_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_244f:
    cmp     byte ptr [detail_level], 0x4
    jnz     LAB_19f1_2459
    jmp     near ptr LAB_19f1_2522
LAB_19f1_2459:
    mov     si, word ptr [bp+unk_x]
    add     si, 0x200
    and     si, 0x3ff
    sub     si, 0x400
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bp+height]
    cmp     word ptr [bx+0x4], ax
    jl      LAB_19f1_2476
    jmp     near ptr LAB_19f1_2522
LAB_19f1_2476:
    sub     ax, word ptr [word_454CE]
    cmp     ax, word ptr [bx+0x6]
    jle     LAB_19f1_2482
    jmp     near ptr LAB_19f1_2522
LAB_19f1_2482:
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    mov     ax, word ptr [bp+height]
    sub     ax, word ptr [skybox_ptr1]
    push    ax
    push    si
    push    word ptr [skyboxes+2]
    push    word ptr [skyboxes]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, word ptr [bp+height]
    sub     ax, word ptr [skybox_ptr2]
    push    ax
    lea     ax, [si+0x140]
    push    ax
    push    word ptr [(skyboxes+1*4)+2]
    push    word ptr [(skyboxes+1*4)]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, word ptr [bp+height]
    sub     ax, word ptr [skybox_ptr3]
    push    ax
    lea     ax, [si+0x200]
    push    ax
    push    word ptr [(skyboxes+2*4)+2]
    push    word ptr [(skyboxes+2*4)]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, word ptr [bp+height]
    sub     ax, word ptr [skybox_ptr4]
    push    ax
    lea     ax, [si+0x340]
    push    ax
    push    word ptr [(skyboxes+3*4)+2]
    push    word ptr [(skyboxes+3*4)]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, word ptr [bp+height]
    sub     ax, word ptr [skybox_ptr1]
    push    ax
    lea     ax, [si+0x400]
    push    ax
    push    word ptr [skyboxes+2]
    push    word ptr [skyboxes]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
LAB_19f1_2522:
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bp+height]
    cmp     word ptr [bx+0x4], ax
    jle     LAB_19f1_2532
    mov     di, word ptr [bx+0x4]
    jmp     LAB_19f1_2535
LAB_19f1_2532:
    mov     di, word ptr [bp+height]
LAB_19f1_2535:
    mov     si, word ptr [bx+0x6]
    sub     si, di
    or      si, si
    jle     LAB_19f1_255d
    mov     ax, di
    add     ax, si
    push    ax
    push    di
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_grd_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_255d:
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
skybox_op_helper2_asm_ endp
    db 0x90

; int __cdecl16far skybox_op(int unk1, RECTANGLE * rect, int unk2, MATRIX * mat, int unk_z, int unk_x, int unk_y)
skybox_op_asm_ proc far
    var_78     = byte ptr  -120
    var_76     = word ptr  -118
    var_72     = word ptr  -114
    var_6E     = word ptr  -110
    var_5C     = word ptr  -92
    var_5A     = word ptr  -90
    var_58     = word ptr  -88
    var_56     = word ptr  -86
    var_54     = word ptr  -84
    var_skyheight = word ptr  -80
    var_point  = dword ptr -78
    var_point2 = dword ptr -74
    var_point3 = dword ptr -70
    var_point4 = dword ptr -66
    var_point5 = dword ptr -62
    var_point6 = dword ptr -58
    var_34     = word ptr  -52
    var_32     = word ptr  -50
    var_rect   = byte ptr  -48
    var_rectptr = word ptr  -40
    var_26     = word ptr  -38
    var_vec    = byte ptr  -36
    var_vec2   = byte ptr  -30
    unk1       = word ptr    6
    rect       = word ptr    8
    unk2       = word ptr   10
    mat        = word ptr   12
    unk_z      = word ptr   14
    unk_x      = word ptr   16
    unk_y      = word ptr   18

    push    bp
    mov     bp, sp
    sub     sp, 0x78
    push    di
    push    si
    mov     byte ptr [rect_array_unk3_length], 0x0
    mov     word ptr [bp+var_5C], 0x0
    mov     bx, word ptr [bp+rect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    cmp     word ptr [bp+unk_z], 0x0
    jnz     LAB_19f1_2597
    jmp     near ptr LAB_19f1_2a48
LAB_19f1_2597:
    mov     ax, 0x4650
    imul    word ptr [bp+unk2]
    mov     word ptr [bp+var_58], ax
    mov     ax, word ptr [bp+unk_y]
    neg     ax
    mov     word ptr [bp+var_56], ax
    mov     ax, 0x3a98
    imul    word ptr [bp+unk2]
    mov     word ptr [bp+var_54], ax
    lea     ax, [bp+var_vec]
    push    ax
    push    word ptr [bp+mat]
    lea     ax, [bp+var_58]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    mov     ax, 0xb9b0
    imul    word ptr [bp+unk2]
    mov     word ptr [bp+var_58], ax
    lea     ax, [bp+var_vec2]
    push    ax
    push    word ptr [bp+mat]
    lea     ax, [bp+var_58]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec+4], 0x0
    jl      LAB_19f1_25ec
    cmp     word ptr [bp+var_vec2+4], 0x0
    jge     LAB_19f1_260c
LAB_19f1_25ec:
    mov     di, word ptr [skybox_sky_color]
LAB_19f1_25f0:
    mov     bx, word ptr [bp+rect]
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    di
    jmp     near ptr LAB_19f1_2c5a
LAB_19f1_260c:
    lea     ax, [bp+var_point]
    push    ax
    lea     ax, [bp+var_vec]
    push    ax
    call    far ptr vector_to_point
    add     sp, 0x4
    lea     ax, [bp+var_point2]
    push    ax
    lea     ax, [bp+var_vec2]
    push    ax
    call    far ptr vector_to_point
    add     sp, 0x4
    cmp     word ptr [bp+var_point], 0x140
    jle     LAB_19f1_2648
    cmp     word ptr [bp+var_point2], 0x140
    jle     LAB_19f1_2648
    mov     ax, word ptr [bp+var_point2+2]
    cmp     word ptr [bp+var_point+2], ax
    jl      LAB_19f1_25ec
LAB_19f1_2642:
    mov     di, word ptr [skybox_grd_color]
    jmp     LAB_19f1_25f0
LAB_19f1_2648:
    cmp     word ptr [bp+var_point], 0x0
    jge     LAB_19f1_265e
    cmp     word ptr [bp+var_point2], 0x0
    jge     LAB_19f1_265e
    mov     ax, word ptr [bp+var_point2+2]
    cmp     word ptr [bp+var_point+2], ax
LAB_19f1_265a:
    jle     LAB_19f1_2642
    jmp     LAB_19f1_25ec
LAB_19f1_265e:
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bp+var_point+2]
    cmp     word ptr [bx+0x6], ax
    jge     LAB_19f1_267a
    mov     ax, word ptr [bp+var_point2+2]
    cmp     word ptr [bx+0x6], ax
    jge     LAB_19f1_267a
    mov     ax, word ptr [bp+var_point2]
    cmp     word ptr [bp+var_point], ax
    jmp     LAB_19f1_265a
    db 0x90
LAB_19f1_267a:
    mov     ax, word ptr [bp+var_point+2]
    cmp     word ptr [bx+0x4], ax
    jle     LAB_19f1_2696
    mov     ax, word ptr [bp+var_point2+2]
    cmp     word ptr [bx+0x4], ax
    jle     LAB_19f1_2696
    mov     ax, word ptr [bp+var_point2]
    cmp     word ptr [bp+var_point], ax
    jge     LAB_19f1_2642
    jmp     near ptr LAB_19f1_25ec
    db 0x90
LAB_19f1_2696:
    mov     word ptr [bp+var_5A], 0x0
    cmp     byte ptr [detail_level], 0x4
    jz      LAB_19f1_270d
    cmp     word ptr [bp+var_point2], 0x0
    jge     LAB_19f1_270d
    cmp     word ptr [bp+var_point], 0x140
    jle     LAB_19f1_270d
    lea     ax, [bp+var_78]
    push    ax
    push    word ptr [bp+var_point+2]
    push    word ptr [bp+var_point]
    push    word ptr [bp+var_point2+2]
    push    word ptr [bp+var_point2]
    call    far ptr draw_line_related
    add     sp, 0xa
    or      ax, ax
    jnz     LAB_19f1_270d
    mov     di, word ptr [bp+var_72]
    sub     di, word ptr [bp+var_6E]
    jns     LAB_19f1_26da
    mov     ax, di
    neg     ax
    jmp     LAB_19f1_26dc
    db 0x90
LAB_19f1_26da:
    mov     ax, di
LAB_19f1_26dc:
    cmp     ax, 0x60
    jge     LAB_19f1_270d
    cmp     word ptr [bp+var_76], 0x0
    jnz     LAB_19f1_26f2
    mov     ax, word ptr [bp+var_72]
    mov     word ptr [bp+var_32], ax
    mov     ax, word ptr [bp+var_6E]
    jmp     LAB_19f1_2702
LAB_19f1_26f2:
    cmp     word ptr [bp+var_76], 0x13f
    jnz     LAB_19f1_270d
    mov     ax, word ptr [bp+var_6E]
    mov     word ptr [bp+var_32], ax
    mov     ax, word ptr [bp+var_72]
LAB_19f1_2702:
    sub     ax, word ptr [bp+var_32]
    mov     word ptr [bp+var_26], ax
    mov     word ptr [bp+var_5A], 0x1
LAB_19f1_270d:
    cmp     word ptr [bp+var_5A], 0x0
    jnz     LAB_19f1_2716
    jmp     near ptr LAB_19f1_2942
LAB_19f1_2716:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_2720
    jmp     near ptr LAB_19f1_28a6
LAB_19f1_2720:
    mov     word ptr [bp+var_rect], 0x0
    mov     word ptr [rect_skybox], 0x0
    mov     word ptr [bp+var_rect+2], 0x140
    mov     word ptr [rect_skybox.rc_right], 0x140
    cmp     byte ptr [byte_454A4], 0x0
    jz      LAB_19f1_2750
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [rect_skybox.rc_top], ax
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [rect_skybox.rc_bottom], ax
    jmp     near ptr LAB_19f1_289a
    db 0x90
LAB_19f1_2750:
    mov     ax, word ptr [bp+var_32]
    add     ax, word ptr [bp+var_26]
    cmp     ax, word ptr [bp+var_32]
    jle     LAB_19f1_275e
    mov     ax, word ptr [bp+var_32]
LAB_19f1_275e:
    sub     ax, word ptr [word_454CE]
    mov     word ptr [rect_skybox.rc_top], ax
    mov     bx, word ptr [bp+rect]
    cmp     word ptr [bx+0x4], ax
    jle     LAB_19f1_2773
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [rect_skybox.rc_top], ax
LAB_19f1_2773:
    mov     ax, word ptr [bp+var_32]
    add     ax, word ptr [bp+var_26]
    cmp     ax, word ptr [bp+var_32]
    jge     LAB_19f1_2781
    mov     ax, word ptr [bp+var_32]
LAB_19f1_2781:
    mov     word ptr [rect_skybox.rc_bottom], ax
    sub     si, si
LAB_19f1_2786:
    mov     byte ptr [si+rect_array_unk_indices], 0x1
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_2786
    mov     byte ptr [(rect_array_unk_indices+5)], 0x3
    mov     word ptr [bp+var_rect+4], 0x0
    mov     ax, word ptr [rect_skybox.rc_top]
    mov     word ptr [bp+var_rect+6], ax
    push    word ptr [bp+rect]
    lea     ax, [bp+var_rect]
    push    ax
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jnz     LAB_19f1_2818
    mov     byte ptr [rect_array_unk3_length], 0x0
    mov     ax, offset rect_array_unk3
    push    ax
    mov     ax, offset rect_array_unk3_length
    push    ax
    lea     ax, [bp+var_rect]
    push    ax
    mov     ax, offset rect_unk
    push    ax
    push    word ptr [rectptr_unk]
    mov     ax, offset rect_array_unk_indices
    push    ax
    mov     ax, 0xf                            ; number of rects
    push    ax
    call    far ptr rectlist_add_rects
    add     sp, 0xe
    sub     di, di
    jmp     LAB_19f1_2810
    db 0x90
LAB_19f1_27e2:
    mov     ax, di
    mov     cl, 0x3
    shl     ax, cl
    add     ax, offset rect_array_unk3
    mov     word ptr [bp+var_rectptr], ax
    mov     bx, ax
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_sky_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    inc     di
LAB_19f1_2810:
    mov     al, byte ptr [rect_array_unk3_length]
    cbw
    cmp     ax, di
    jg      LAB_19f1_27e2
LAB_19f1_2818:
    mov     ax, word ptr [rect_skybox.rc_bottom]
    mov     word ptr [bp+var_rect+4], ax
    mov     word ptr [bp+var_rect+6], 0xc8
    push    word ptr [bp+rect]
    lea     ax, [bp+var_rect]
    push    ax
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jnz     LAB_19f1_289a
    mov     byte ptr [rect_array_unk3_length], 0x0
    mov     ax, offset rect_array_unk3
    push    ax
    mov     ax, offset rect_array_unk3_length
    push    ax
    lea     ax, [bp+var_rect]
    push    ax
    mov     ax, offset rect_unk
    push    ax
    push    word ptr [rectptr_unk]
    mov     ax, offset rect_array_unk_indices
    push    ax
    mov     ax, 0xf                            ; number of rects
    push    ax
    call    far ptr rectlist_add_rects
    add     sp, 0xe
    sub     di, di
    jmp     LAB_19f1_2892
    db 0x90
LAB_19f1_2864:
    mov     ax, di
    mov     cl, 0x3
    shl     ax, cl
    add     ax, offset rect_array_unk3
    mov     word ptr [bp+var_rectptr], ax
    mov     bx, ax
    push    word ptr [bx+0x6]
    push    word ptr [bx+0x4]
    push    word ptr [bx+0x2]
    push    word ptr [bx]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_grd_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    inc     di
LAB_19f1_2892:
    mov     al, byte ptr [rect_array_unk3_length]
    cbw
    cmp     ax, di
    jg      LAB_19f1_2864
LAB_19f1_289a:
    mov     ax, word ptr [rect_skybox.rc_top]
    mov     word ptr [bp+var_rect+4], ax
    mov     ax, word ptr [rect_skybox.rc_bottom]
    jmp     LAB_19f1_28b2
    db 0x90
LAB_19f1_28a6:
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [bp+var_rect+4], ax
    mov     ax, word ptr [bx+0x6]
LAB_19f1_28b2:
    mov     word ptr [bp+var_rect+6], ax
    mov     word ptr [bp+var_rect], 0x0
    mov     word ptr [bp+var_rect+2], 0x140
    push    word ptr [bp+rect]
    lea     ax, [bp+var_rect]
    push    ax
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jz      LAB_19f1_28d5
    jmp     near ptr LAB_19f1_2c67
LAB_19f1_28d5:
    mov     word ptr [bp+var_34], 0x0
    cmp     word ptr [bp+var_26], 0x0
    jge     LAB_19f1_28e8
    mov     ax, word ptr [bp+var_26]
    neg     ax
    jmp     LAB_19f1_28eb
    db 0x90
LAB_19f1_28e8:
    mov     ax, word ptr [bp+var_26]
LAB_19f1_28eb:
    mov     di, ax
    inc     di
    cmp     di, 0x20
    jle     LAB_19f1_28f6
    mov     di, 0x20
LAB_19f1_28f6:
    sub     si, si
    jmp     LAB_19f1_293b
LAB_19f1_28fa:
    mov     ax, word ptr [bp+var_34]
    mov     word ptr [bp+var_rect], ax
    mov     ax, 0x140
    imul    si
    add     ax, 0x140
    cwd
    idiv    di
    and     ax, word ptr [video_flag3_isFFFF]
    mov     word ptr [bp+var_rect+2], ax
    cmp     word ptr [bp+var_rect], ax
    jz      LAB_19f1_293a
    mov     ax, word ptr [bp+var_26]
    imul    si
    cwd
    idiv    di
    add     ax, word ptr [bp+var_32]
    mov     word ptr [bp+var_skyheight], ax
    push    ax
    push    word ptr [bp+unk_x]
    lea     ax, [bp+var_rect]
    push    ax
    push    cs
    call    near ptr skybox_op_helper2
    add     sp, 0x6
    mov     ax, word ptr [bp+var_rect+2]
    mov     word ptr [bp+var_34], ax
LAB_19f1_293a:
    inc     si
LAB_19f1_293b:
    cmp     si, di
    jl      LAB_19f1_28fa
    jmp     near ptr LAB_19f1_2c67
LAB_19f1_2942:
    mov     ax, word ptr [bp+var_point+2]
    sub     ax, word ptr [bp+var_point2+2]
    push    ax
    mov     ax, word ptr [bp+var_point]
    sub     ax, word ptr [bp+var_point2]
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    mov     si, ax
    and     si, 0x3ff
    mov     word ptr [bp+var_26], 0x2
    jmp     LAB_19f1_29e0
    db 0x90
LAB_19f1_2966:
    mov     di, 0x1
LAB_19f1_2969:
    mov     bx, word ptr [bp+var_26]
    shl     bx, 0x1
    mov     ax, word ptr [bx+0x98c]
    add     ax, si
    push    ax
    call    far ptr int_sin
    add     sp, 0x2
    push    ax
    mov     ax, 0x3e80
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     bx, di
    shl     bx, 0x1
    shl     bx, 0x1
    add     bx, bp
    mov     cx, word ptr [bx-0x4e]
    add     cx, ax
    mov     bx, word ptr [bp+var_26]
    shl     bx, 0x1
    shl     bx, 0x1
    add     bx, bp
    mov     word ptr [bx-0x4e], cx
    mov     bx, word ptr [bp+var_26]
    shl     bx, 0x1
    mov     ax, word ptr [bx+0x98c]
    add     ax, si
    push    ax
    call    far ptr int_cos
    add     sp, 0x2
    push    ax
    mov     ax, 0x3e80
    push    ax
    call    far ptr multiply_and_scale
    add     sp, 0x4
    mov     bx, di
    shl     bx, 0x1
    shl     bx, 0x1
    add     bx, bp
    mov     cx, word ptr [bx-0x4c]
    add     cx, ax
    mov     bx, word ptr [bp+var_26]
    shl     bx, 0x1
    shl     bx, 0x1
    add     bx, bp
    mov     word ptr [bx-0x4c], cx
    inc     word ptr [bp+var_26]
LAB_19f1_29e0:
    cmp     word ptr [bp+var_26], 0x6
    jge     LAB_19f1_29f4
    cmp     word ptr [bp+var_26], 0x4
    jl      LAB_19f1_29ef
    jmp     near ptr LAB_19f1_2966
LAB_19f1_29ef:
    sub     di, di
    jmp     near ptr LAB_19f1_2969
LAB_19f1_29f4:
    push    word ptr [bp+var_point3+2]
    push    word ptr [bp+var_point3]
    push    word ptr [bp+var_point4+2]
    push    word ptr [bp+var_point4]
    push    word ptr [bp+var_point2+2]
    push    word ptr [bp+var_point2]
    push    word ptr [bp+var_point+2]
    push    word ptr [bp+var_point]
    mov     ax, 0x4
    push    ax
    push    word ptr [skybox_sky_color]
    call    far ptr skybox_op_helper
    add     sp, 0x14
    push    word ptr [bp+var_point6+2]
    push    word ptr [bp+var_point6]
    push    word ptr [bp+var_point5+2]
    push    word ptr [bp+var_point5]
    push    word ptr [bp+var_point2+2]
    push    word ptr [bp+var_point2]
    push    word ptr [bp+var_point+2]
    push    word ptr [bp+var_point]
    mov     ax, 0x4
    push    ax
    push    word ptr [skybox_grd_color]
    call    far ptr skybox_op_helper
    add     sp, 0x14
    jmp     near ptr LAB_19f1_2c62
    db 0x90
LAB_19f1_2a48:
    mov     word ptr [bp+var_58], 0x0
    mov     ax, word ptr [bp+unk_y]
    neg     ax
    mov     word ptr [bp+var_56], ax
    mov     ax, 0x3a98
    imul    word ptr [bp+unk2]
    mov     word ptr [bp+var_54], ax
    lea     ax, [bp+var_vec]
    push    ax
    push    word ptr [bp+mat]
    lea     ax, [bp+var_58]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec+4], 0x0
    jge     LAB_19f1_2ab0
    push    word ptr [skybox_sky_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_2a8d
    jmp     near ptr LAB_19f1_2c67
LAB_19f1_2a8d:
    mov     word ptr [bp+var_5C], 0x1
    mov     word ptr [rect_skybox], 0x0
    mov     word ptr [rect_skybox.rc_right], 0x140
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [rect_skybox.rc_top], ax
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [rect_skybox.rc_bottom], ax
    jmp     near ptr LAB_19f1_2c67
LAB_19f1_2ab0:
    lea     ax, [bp+var_point]
    push    ax
    lea     ax, [bp+var_vec]
    push    ax
    call    far ptr vector_to_point
    add     sp, 0x4
    mov     ax, word ptr [bp+var_point+2]
    mov     word ptr [bp+var_skyheight], ax
    mov     bx, word ptr [bp+rect]
    cmp     word ptr [bx+0x4], ax
    jle     LAB_19f1_2ad4
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [bp+var_skyheight], ax
LAB_19f1_2ad4:
    cmp     word ptr [bp+unk2], 0x1
    jz      LAB_19f1_2add
    jmp     near ptr LAB_19f1_2bf0
LAB_19f1_2add:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_2b15
    cmp     byte ptr [detail_level], 0x4
    jnz     LAB_19f1_2af2
    mov     ax, word ptr [bp+var_skyheight]
    dec     ax
    jmp     LAB_19f1_2af9
    db 0x90
LAB_19f1_2af2:
    mov     ax, word ptr [bp+var_skyheight]
    sub     ax, word ptr [word_454CE]
LAB_19f1_2af9:
    mov     word ptr [rect_skybox.rc_top], ax
    mov     word ptr [rect_skybox], 0x0
    mov     word ptr [rect_skybox.rc_right], 0x140
    mov     ax, word ptr [bp+var_skyheight]
    mov     word ptr [rect_skybox.rc_bottom], ax
    cmp     byte ptr [byte_454A4], 0x0
    jz      LAB_19f1_2b42
LAB_19f1_2b15:
    mov     word ptr [bp+var_rect], 0x0
    mov     word ptr [bp+var_rect+2], 0x140
    mov     bx, word ptr [bp+rect]
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [bp+var_rect+4], ax
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [bp+var_rect+6], ax
    push    word ptr [bp+var_skyheight]
    push    word ptr [bp+unk_x]
    lea     ax, [bp+var_rect]
    push    ax
    push    cs
    call    near ptr skybox_op_helper2
    add     sp, 0x6
    jmp     near ptr LAB_19f1_2c67
LAB_19f1_2b42:
    sub     si, si
LAB_19f1_2b44:
    mov     byte ptr [si+rect_array_unk_indices], 0x1
    inc     si
    cmp     si, 0xf
    jl      LAB_19f1_2b44
    cmp     byte ptr [detail_level], 0x4
    jnz     LAB_19f1_2b62
    mov     bx, word ptr [bp+unk1]
    shl     bx, 0x1
    mov     ax, word ptr [word_463D6]
    mov     word ptr [bx+word_449FC], ax
LAB_19f1_2b62:
    mov     bx, word ptr [bp+unk1]
    shl     bx, 0x1
    mov     ax, word ptr [bp+unk_x]
    cmp     word ptr [bx+word_449FC], ax
    jnz     LAB_19f1_2b9c
    mov     bx, word ptr [rectptr_unk]
    mov     ax, word ptr [rect_skybox]
    cmp     word ptr [bx+0x28], ax
    jnz     LAB_19f1_2b9c
    mov     ax, word ptr [rect_skybox.rc_right]
    cmp     word ptr [bx+0x2a], ax
    jnz     LAB_19f1_2b9c
    mov     ax, word ptr [rect_skybox.rc_top]
    cmp     word ptr [bx+0x2c], ax
    jnz     LAB_19f1_2b9c
    mov     ax, word ptr [rect_skybox.rc_bottom]
    cmp     word ptr [bx+0x2e], ax
    jnz     LAB_19f1_2b9c
    mov     byte ptr [(rect_array_unk_indices+5)], 0x0
    jmp     LAB_19f1_2ba1
    db 0x90
LAB_19f1_2b9c:
    mov     byte ptr [(rect_array_unk_indices+5)], 0x3
LAB_19f1_2ba1:
    mov     byte ptr [rect_array_unk3_length], 0x0
    mov     ax, offset rect_array_unk3
    push    ax
    mov     ax, offset rect_array_unk3_length
    push    ax
    push    word ptr [bp+rect]
    mov     ax, offset rect_unk
    push    ax
    push    word ptr [rectptr_unk]
    mov     ax, offset rect_array_unk_indices
    push    ax
    mov     ax, 0xf                            ; number of rects
    push    ax
    call    far ptr rectlist_add_rects
    add     sp, 0xe
    sub     di, di
    jmp     LAB_19f1_2be6
    db 0x90
LAB_19f1_2bce:
    push    word ptr [bp+var_skyheight]
    push    word ptr [bp+unk_x]
    mov     ax, di
    mov     cl, 0x3
    shl     ax, cl
    add     ax, offset rect_array_unk3
    push    ax
    push    cs
    call    near ptr skybox_op_helper2
    add     sp, 0x6
    inc     di
LAB_19f1_2be6:
    mov     al, byte ptr [rect_array_unk3_length]
    cbw
    cmp     ax, di
    jg      LAB_19f1_2bce
    jmp     LAB_19f1_2c67
LAB_19f1_2bf0:
    mov     si, word ptr [bp+var_skyheight]
    mov     bx, word ptr [bp+rect]
    sub     si, word ptr [bx+0x4]
    mov     ax, word ptr [bx+0x6]
    sub     ax, word ptr [bx+0x4]
    cmp     ax, si
    jge     LAB_19f1_2c09
    mov     si, word ptr [bx+0x6]
    sub     si, word ptr [bx+0x4]
LAB_19f1_2c09:
    or      si, si
    jle     LAB_19f1_2c31
    mov     ax, word ptr [bx+0x4]
    add     ax, si
    push    ax
    push    word ptr [bx+0x4]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_grd_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_2c31:
    mov     bx, word ptr [bp+rect]
    mov     si, word ptr [bx+0x6]
    sub     si, word ptr [bp+var_skyheight]
    or      si, si
    jle     LAB_19f1_2c62
    mov     ax, word ptr [bp+var_skyheight]
    add     ax, si
    push    ax
    push    word ptr [bp+var_skyheight]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_sky_color]
LAB_19f1_2c5a:
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_2c62:
    mov     word ptr [bp+var_5C], 0x1
LAB_19f1_2c67:
    mov     ax, word ptr [bp+var_5C]
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
skybox_op_asm_ endp

; void __cdecl16far transformed_shape_add_for_sort(int z_adjust, byte param_2)
transformed_shape_add_for_sort_asm_ proc far
    transformedpos = byte ptr  -12
    shapepos   = byte ptr   -6
    z_adjust   = word ptr    6
    param_2    = byte ptr    8

    push    bp
    mov     bp, sp
    sub     sp, 0xc
    push    di
    push    si
    mov     ax, word ptr [curtransshape_ptr]
    push    si
    push    di
    lea     di, [bp+shapepos]
    mov     si, ax                             ; ax = offset to the first member of curtransshape_ptr, the pos vector
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    lea     ax, [bp+transformedpos]
    push    ax
    mov     ax, offset mat_temp
    push    ax
    lea     ax, [bp+shapepos]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    mov     al, byte ptr [transformedshape_counter]
    cbw
    mov     si, ax
    mov     di, si
    shl     di, 0x1
    mov     ax, word ptr [bp+transformedpos+4]
    add     ax, word ptr [bp+z_adjust]
    mov     word ptr [di+transformedshape_zarray], ax
    mov     al, byte ptr [bp+param_2]
    mov     byte ptr [si+transformedshape_arg2array], al
    mov     word ptr [di+transformedshape_indices], si
    inc     byte ptr [transformedshape_counter]
    add     word ptr [curtransshape_ptr], 0x14
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
transformed_shape_add_for_sort_asm_ endp
    db 0x90

; void __cdecl16far draw_track_preview(void)
draw_track_preview_asm_ proc far
    var_42     = word ptr  -66
    var_40     = word ptr  -64
    var_3E     = word ptr  -62
    var_3C     = byte ptr  -60
    var_3A     = byte ptr  -58
    var_38     = byte ptr  -56
    var_36     = byte ptr  -54
    var_34     = word ptr  -52
    var_32     = byte ptr  -50
    var_30     = word ptr  -48
    var_2E     = byte ptr  -46
    var_2C     = word ptr  -44
    var_2A     = word ptr  -42
    var_28     = word ptr  -40
    var_transshape = byte ptr  -38
    var_12     = word ptr  -18
    var_10     = byte ptr  -16
    var_vec    = byte ptr  -12
    var_4      = word ptr   -4
    var_2      = word ptr   -2

    push    bp
    mov     bp, sp
    sub     sp, 0x42
    push    di
    push    si
    mov     ax, word ptr [word_3C112]
    sub     ax, word ptr [word_3C10C]
    push    ax
    mov     ax, word ptr [word_3C10E]
    sub     ax, word ptr [word_3C108]
    push    ax
    call    far ptr int_hypot
    add     sp, 0x4
    mov     word ptr [bp+var_4], ax
    push    ax
    mov     ax, word ptr [word_3C110]
    sub     ax, word ptr [word_3C10A]
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    mov     word ptr [bp+var_34], ax
    mov     ax, 0x1
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [bp+var_34]
    push    ax
    call    far ptr mat_rot_zxy
    add     sp, 0x8
    mov     word ptr [bp+var_28], ax
    lea     ax, [bp+var_vec]
    push    ax
    push    word ptr [bp+var_28]
    mov     ax, offset unk_3C114
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    lea     ax, [bp+var_2E]
    push    ax
    lea     ax, [bp+var_vec]
    push    ax
    call    far ptr vector_to_point
    add     sp, 0x4
    mov     ax, word ptr [bp+var_2C]
    mov     word ptr [bp+var_30], ax
    or      ax, ax
    jge     LAB_19f1_2d4b
    mov     word ptr [bp+var_30], 0x0
LAB_19f1_2d4b:
    mov     ax, word ptr [bp+var_30]
    sub     ax, word ptr [skybox_current]
    push    ax
    sub     ax, ax
    push    ax
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_sky_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    mov     ax, 0x64
    push    ax
    sub     ax, ax
    push    ax
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    mov     ax, word ptr [bp+var_30]
    sub     ax, word ptr [skybox_ptr3]
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [(skyboxes+2*4)+2]
    push    word ptr [(skyboxes+2*4)]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, word ptr [bp+var_30]
    sub     ax, word ptr [skybox_ptr4]
    push    ax
    mov     ax, 0x140
    push    ax
    push    word ptr [(skyboxes+3*4)+2]
    push    word ptr [(skyboxes+3*4)]
    call    far ptr sprite_putimage_and_alt
    add     sp, 0x8
    mov     ax, 0xc8
    push    ax
    push    word ptr [bp+var_30]
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_grd_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    mov     ax, 0xc8
    push    ax
    sub     ax, ax
    push    ax
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    mov     ax, 0x1
    push    ax
    mov     ax, offset trackpreview_cliprect
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [bp+var_34]
    push    ax
    call    far ptr select_cliprect_rotate
    add     sp, 0xa
    mov     word ptr [bp+var_transshape+10], 0x0
    mov     word ptr [bp+var_transshape+12], 0x0
    mov     word ptr [bp+var_transshape+16], 0x400
    mov     byte ptr [bp+var_38], 0x0
    jmp     near ptr LAB_19f1_320b
    db 0x90
LAB_19f1_2e24:
    mov     byte ptr [bp+var_3A], 0x0
    mov     byte ptr [bp+var_10], 0x0
LAB_19f1_2e2c:
    cmp     byte ptr [bp+var_3A], 0x6
    jz      LAB_19f1_2e35
    jmp     near ptr LAB_19f1_2ef4
LAB_19f1_2e35:
    mov     di, word ptr [(hillHeightConsts+1*2)]
    cmp     byte ptr [bp+var_10], 0x0
    jz      LAB_19f1_2e43
LAB_19f1_2e3f:
    mov     byte ptr [bp+var_3A], 0x0
LAB_19f1_2e43:
    cmp     byte ptr [bp+var_3A], 0x0
    jz      LAB_19f1_2eba
    mov     al, byte ptr [bp+var_3A]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes2
    mov     word ptr [bp+var_3E], ax
    mov     bx, ax
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [bp+var_transshape+6], ax
    mov     al, byte ptr [bp+var_32]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    sub     ax, word ptr [word_3C108]
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape], ax
    mov     ax, di
    sub     ax, word ptr [word_3C10A]
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape+2], ax
    mov     al, byte ptr [bp+var_38]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos]
    sub     ax, word ptr [word_3C10C]
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape+4], ax
    mov     bx, word ptr [bp+var_3E]
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [bp+var_transshape+14], ax
    mov     byte ptr [bp+var_transshape+18], 0x5
    mov     byte ptr [bp+var_transshape+19], 0x0
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_2eba:
    cmp     byte ptr [bp+var_10], 0x0
    jnz     LAB_19f1_2ec3
    jmp     near ptr LAB_19f1_3176
LAB_19f1_2ec3:
    mov     al, byte ptr [bp+var_10]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_3E], ax
    mov     bx, ax
    test    byte ptr [bx+0xb], 0x1
    jnz     LAB_19f1_2ee5
    jmp     near ptr LAB_19f1_3004
LAB_19f1_2ee5:
    mov     al, byte ptr [bp+var_38]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackpos]
    jmp     near ptr LAB_19f1_3010
LAB_19f1_2ef4:
    sub     di, di
    mov     al, byte ptr [bp+var_10]
    sub     ah, ah
    cmp     ax, 0x69
    jnc     LAB_19f1_2f03
    jmp     near ptr LAB_19f1_2e43
LAB_19f1_2f03:
    cmp     ax, 0x6c
    jbe     LAB_19f1_2f0b
    jmp     near ptr LAB_19f1_2e43
LAB_19f1_2f0b:
    mov     word ptr [bp+var_2A], di
    jmp     near ptr LAB_19f1_2fc0
    db 0x90
LAB_19f1_2f12:
    mov     al, byte ptr [bp+var_32]
LAB_19f1_2f15:
    mov     byte ptr [bp+var_36], al
    mov     al, byte ptr [bp+var_38]
LAB_19f1_2f1b:
    mov     byte ptr [bp+var_3C], al
LAB_19f1_2f1e:
    mov     al, byte ptr [bp+var_36]
    cbw
    mov     word ptr [bp+var_42], ax
    mov     al, byte ptr [bp+var_3C]
    cbw
    shl     ax, 0x1
    mov     word ptr [bp+var_40], ax
    mov     bx, ax
    mov     bx, word ptr [bx+terrainrows]
    add     bx, word ptr [bp+var_42]
    add     bx, word ptr [td15_terr_map_main]
    mov     es, word ptr [td15_terr_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+var_3A], al
    or      al, al
    jz      LAB_19f1_2fbd
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset sceneshapes2
    mov     word ptr [bp+var_3E], ax
    mov     bx, ax
    mov     ax, word ptr [bx+0x4]
    mov     word ptr [bp+var_transshape+6], ax
    mov     bx, word ptr [bp+var_42]
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos2]
    sub     ax, word ptr [word_3C108]
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape], ax
    mov     ax, word ptr [word_3C10A]
    neg     ax
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape+2], ax
    mov     bx, word ptr [bp+var_40]
    mov     ax, word ptr [bx+trackcenterpos]
    sub     ax, word ptr [word_3C10C]
    sar     ax, 0x1
    mov     word ptr [bp+var_transshape+4], ax
    mov     byte ptr [bp+var_transshape+18], 0x5
    mov     word ptr [bp+var_transshape+10], 0x0
    mov     word ptr [bp+var_transshape+12], 0x0
    mov     bx, word ptr [bp+var_3E]
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [bp+var_transshape+14], ax
    mov     word ptr [bp+var_transshape+16], 0x400
    mov     byte ptr [bp+var_transshape+19], 0x0
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_2fbd:
    inc     word ptr [bp+var_2A]
LAB_19f1_2fc0:
    cmp     word ptr [bp+var_2A], 0x4
    jl      LAB_19f1_2fc9
    jmp     near ptr LAB_19f1_2e3f
LAB_19f1_2fc9:
    mov     ax, word ptr [bp+var_2A]
    or      ax, ax
    jnz     LAB_19f1_2fd3
    jmp     near ptr LAB_19f1_2f12
LAB_19f1_2fd3:
    cmp     ax, 0x1
    jz      LAB_19f1_2fe6
    cmp     ax, 0x2
    jz      LAB_19f1_2fee
    cmp     ax, 0x3
    jz      LAB_19f1_2ffc
    jmp     near ptr LAB_19f1_2f1e
    db 0x90
LAB_19f1_2fe6:
    mov     al, byte ptr [bp+var_32]
    inc     al
    jmp     near ptr LAB_19f1_2f15
LAB_19f1_2fee:
    mov     al, byte ptr [bp+var_32]
LAB_19f1_2ff1:
    mov     byte ptr [bp+var_36], al
    mov     al, byte ptr [bp+var_38]
    inc     al
    jmp     near ptr LAB_19f1_2f1b
LAB_19f1_2ffc:
    mov     al, byte ptr [bp+var_32]
    inc     al
    jmp     LAB_19f1_2ff1
    db 0x90
LAB_19f1_3004:
    mov     al, byte ptr [bp+var_38]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     ax, word ptr [bx+trackcenterpos]
LAB_19f1_3010:
    mov     word ptr [bp+var_12], ax
    mov     bx, word ptr [bp+var_3E]
    test    byte ptr [bx+0xb], 0x2
    jz      LAB_19f1_302a
    mov     al, byte ptr [bp+var_32]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     si, word ptr [bx+(trackpos2+1*2)]
    jmp     LAB_19f1_3036
LAB_19f1_302a:
    mov     al, byte ptr [bp+var_32]
    cbw
    mov     bx, ax
    shl     bx, 0x1
    mov     si, word ptr [bx+trackcenterpos2]
LAB_19f1_3036:
    mov     ax, si
    sub     ax, word ptr [word_3C108]
    sar     ax, 0x1
    mov     word ptr [bp+var_vec], ax
    mov     ax, di
    sub     ax, word ptr [word_3C10A]
    sar     ax, 0x1
    mov     word ptr [bp+var_vec+2], ax
    mov     ax, word ptr [bp+var_12]
    sub     ax, word ptr [word_3C10C]
    sar     ax, 0x1
    mov     word ptr [bp+var_vec+4], ax
    or      di, di
    jz      LAB_19f1_30af
    mov     bx, word ptr [bp+var_3E]
    mov     al, byte ptr [bx+0xb]
    cbw
    or      ax, ax
    jz      LAB_19f1_3082
    cmp     ax, 0x1
    jnz     LAB_19f1_306f
    jmp     near ptr LAB_19f1_310a
LAB_19f1_306f:
    cmp     ax, 0x2
    jnz     LAB_19f1_3077
    jmp     near ptr LAB_19f1_3112
LAB_19f1_3077:
    cmp     ax, 0x3
    jnz     LAB_19f1_307f
    jmp     near ptr LAB_19f1_311a
LAB_19f1_307f:
    jmp     LAB_19f1_3087
    db 0x90
LAB_19f1_3082:
    mov     word ptr [bp+var_transshape+6], offset (game3dshapes+43*22).shape3d_numverts
LAB_19f1_3087:
    push    si
    push    di
    lea     di, [bp+var_transshape]
    lea     si, [bp+var_vec]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     word ptr [bp+var_transshape+14], 0x0
    mov     byte ptr [bp+var_transshape+18], 0x5
    mov     byte ptr [bp+var_transshape+19], 0x0
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_30af:
    mov     bx, word ptr [bp+var_3E]
    cmp     byte ptr [bx+0x8], 0x0
    jz      LAB_19f1_3132
    mov     al, byte ptr [bx+0x8]
    sub     ah, ah
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, offset trkObjectList
    mov     word ptr [bp+var_2], ax
    mov     bx, ax
    cmp     word ptr [bx+0x6], 0x0
    jz      LAB_19f1_3132
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [bp+var_transshape+6], ax
    push    si
    push    di
    lea     di, [bp+var_transshape]
    lea     si, [bp+var_vec]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     bx, word ptr [bp+var_3E]
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [bp+var_transshape+14], ax
    mov     byte ptr [bp+var_transshape+18], 0x5
    mov     bx, word ptr [bp+var_2]
    cmp     byte ptr [bx+0x9], 0x0
    jl      LAB_19f1_3122
    mov     al, byte ptr [bx+0x9]
    mov     byte ptr [bp+var_transshape+19], al
    jmp     LAB_19f1_3126
LAB_19f1_310a:
    mov     word ptr [bp+var_transshape+6], offset (game3dshapes+91*22).shape3d_numverts
    jmp     near ptr LAB_19f1_3087
LAB_19f1_3112:
    mov     word ptr [bp+var_transshape+6], offset (game3dshapes+92*22).shape3d_numverts
    jmp     near ptr LAB_19f1_3087
LAB_19f1_311a:
    mov     word ptr [bp+var_transshape+6], offset (game3dshapes+93*22).shape3d_numverts
    jmp     near ptr LAB_19f1_3087
LAB_19f1_3122:
    mov     byte ptr [bp+var_transshape+19], 0x0
LAB_19f1_3126:
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_3132:
    mov     bx, word ptr [bp+var_3E]
    mov     ax, word ptr [bx+0x6]
    mov     word ptr [bp+var_transshape+6], ax
    push    si
    push    di
    lea     di, [bp+var_transshape]
    lea     si, [bp+var_vec]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     ax, word ptr [bx+0x2]
    mov     word ptr [bp+var_transshape+14], ax
    mov     al, byte ptr [bx+0xa]
    or      al, 0x4
    mov     byte ptr [bp+var_transshape+18], al
    cmp     byte ptr [bx+0x9], 0x0
    jl      LAB_19f1_3166
    mov     al, byte ptr [bx+0x9]
    mov     byte ptr [bp+var_transshape+19], al
    jmp     LAB_19f1_316a
LAB_19f1_3166:
    mov     byte ptr [bp+var_transshape+19], 0x0
LAB_19f1_316a:
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_3176:
    call    far ptr get_a_poly_info
    inc     byte ptr [bp+var_32]
LAB_19f1_317e:
    cmp     byte ptr [bp+var_32], 0x1e
    jl      LAB_19f1_3187
    jmp     near ptr LAB_19f1_3208
LAB_19f1_3187:
    mov     al, byte ptr [bp+var_32]
    cbw
    mov     word ptr [bp+var_40], ax
    mov     al, byte ptr [bp+var_38]
    cbw
    shl     ax, 0x1
    mov     word ptr [bp+var_42], ax
    mov     bx, ax
    mov     bx, word ptr [bx+trackrows]
    add     bx, word ptr [bp+var_40]
    add     bx, word ptr [td14_elem_map_main]
    mov     es, word ptr [td14_elem_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+var_10], al
    mov     bx, word ptr [bp+var_42]
    mov     bx, word ptr [bx+terrainrows]
    add     bx, word ptr [bp+var_40]
    add     bx, word ptr [td15_terr_map_main]
    mov     es, word ptr [td15_terr_map_main+2]
    mov     al, byte ptr es:[bx]
    mov     byte ptr [bp+var_3A], al
    cmp     byte ptr [bp+var_10], 0x0
    jnz     LAB_19f1_31cf
    jmp     near ptr LAB_19f1_2e2c
LAB_19f1_31cf:
    cmp     al, 0x7
    jc      LAB_19f1_31f0
    cmp     al, 0xb
    jnc     LAB_19f1_31f0
    mov     al, byte ptr [bp+var_10]
    sub     ah, ah
    push    ax
    mov     al, byte ptr [bp+var_3A]
    push    ax
    call    far ptr subst_hillroad_track
    add     sp, 0x4
    mov     byte ptr [bp+var_10], al
    mov     byte ptr [bp+var_3A], 0x0
LAB_19f1_31f0:
    mov     al, byte ptr [bp+var_10]
    sub     ah, ah
    cmp     ax, 0xfd
    jnc     LAB_19f1_31fd
    jmp     near ptr LAB_19f1_2e2c
LAB_19f1_31fd:
    cmp     ax, 0xff
    ja      LAB_19f1_3205
    jmp     near ptr LAB_19f1_2e24
LAB_19f1_3205:
    jmp     near ptr LAB_19f1_2e2c
LAB_19f1_3208:
    inc     byte ptr [bp+var_38]
LAB_19f1_320b:
    cmp     byte ptr [bp+var_38], 0x1e
    jge     LAB_19f1_3218
    mov     byte ptr [bp+var_32], 0x0
    jmp     near ptr LAB_19f1_317e
LAB_19f1_3218:
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
draw_track_preview_asm_ endp

; RECTANGLE * __cdecl16far draw_ingame_text(void)
draw_ingame_text_asm_ proc far
    push    bp
    mov     bp, sp
    sub     sp, 0x2
    push    di
    push    si
    push    si
    mov     di, offset rect_ingame_text
    mov     si, offset cliprect_unk
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     si
    cmp     byte ptr [idle_expired], 0x0
    jnz     LAB_19f1_323e
    jmp     near ptr LAB_19f1_32d6
LAB_19f1_323e:
    mov     ax, offset aDm1                    ; "Professional Driver"
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0xaa
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr font_op2_alt
    add     sp, 0x2
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset aDm2                    ; on Closed Circuit
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0xb6
LAB_19f1_32c5:
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr font_op2_alt
    add     sp, 0x2
    jmp     near ptr LAB_19f1_3601
    db 0x90
LAB_19f1_32d6:
    cmp     byte ptr [game_replay_mode], 0x0
    jz      LAB_19f1_32e0
    jmp     near ptr LAB_19f1_35a0
LAB_19f1_32e0:
    cmp     byte ptr [state.game_inputmode], 0x0
    jnz     LAB_19f1_331a
    mov     ax, offset aPre                    ; Fasten Your Seatbelt
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x5a
    jmp     LAB_19f1_32c5
    db 0x90
LAB_19f1_331a:
    cmp     byte ptr [passed_security], 0x0
    jz      LAB_19f1_3324
    jmp     near ptr LAB_19f1_33ae
LAB_19f1_3324:
    mov     ax, offset aSe1                    ; You forgot to disable the
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x5d
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr font_op2_alt
    add     sp, 0x2
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset aSe2                    ; "Car's security system first"
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x69
    jmp     near ptr LAB_19f1_32c5
LAB_19f1_33ae:
    cmp     byte ptr [followOpponentFlag], 0x0
    jz      LAB_19f1_33b8
    jmp     near ptr LAB_19f1_361b
LAB_19f1_33b8:
    cmp     byte ptr [cameramode], 0x0
    jz      LAB_19f1_33c2
    jmp     near ptr LAB_19f1_361b
LAB_19f1_33c2:
    cmp     byte ptr [state.playerstate.car_crashBmpFlag], 0x0
    jz      LAB_19f1_33cc
    jmp     near ptr LAB_19f1_361b
LAB_19f1_33cc:
    mov     al, byte ptr [state.field_45D]
    cbw
    cmp     ax, 0x1
    jz      LAB_19f1_33e2
    cmp     ax, 0x2
    jz      LAB_19f1_3428
    cmp     ax, 0x3
    jz      LAB_19f1_343a
    jmp     LAB_19f1_340e
    db 0x90
LAB_19f1_33e2:
    mov     ax, 0x5d
    push    ax
    mov     ax, 0x94
    push    ax
    push    word ptr [(sdgame2shapes+3*4)+2]   ; left arrow shape
    push    word ptr [(sdgame2shapes+3*4)]     ; left arrow shape
LAB_19f1_33f2:
    call    far ptr sprite_putimage_transparent
    add     sp, 0x8
    mov     ax, offset rect_ingame_text
    push    ax
    mov     ax, offset rect_ingame_text2
LAB_19f1_3401:
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
LAB_19f1_340e:
    mov     byte ptr [g_res_id], 0x0
    mov     al, byte ptr [state.field_45E]
    cbw
    cmp     ax, 0x1
    jz      LAB_19f1_3488
    cmp     ax, 0x2
    jnz     LAB_19f1_3424
    jmp     near ptr LAB_19f1_356e
LAB_19f1_3424:
    jmp     near ptr LAB_19f1_34d6
    db 0x90
LAB_19f1_3428:
    mov     ax, 0x5d
    push    ax
    mov     ax, 0x94
    push    ax
    push    word ptr [(sdgame2shapes+4*4)+2]   ; right arrow shape
    push    word ptr [(sdgame2shapes+4*4)]     ; right arrow shape
    jmp     LAB_19f1_33f2
LAB_19f1_343a:
    mov     ax, offset aWww                    ; "Wrong Way"
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x5d
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr font_op2_alt
    add     sp, 0x2
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    jmp     near ptr LAB_19f1_3401
    db 0x90
LAB_19f1_3488:
    mov     ax, 0x71
    push    ax
    mov     ax, 0x44
    push    ax
    push    word ptr [(sdgame2shapes+3*4)+2]   ; left arrow shape
    push    word ptr [(sdgame2shapes+3*4)]     ; left arrow shape
    call    far ptr sprite_putimage_transparent
    add     sp, 0x8
    mov     ax, offset rect_ingame_text
    push    ax
    mov     ax, offset rect_ingame_text3
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset aOpp                    ; "Opponent Near"
LAB_19f1_34b7:
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
LAB_19f1_34d6:
    cmp     byte ptr [g_res_id], 0x0
    jz      LAB_19f1_3512
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x74
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr font_op2_alt
    add     sp, 0x2
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
LAB_19f1_3512:
    cmp     byte ptr [show_penalty_counter], 0x0
    jnz     LAB_19f1_351c
    jmp     near ptr LAB_19f1_361b
LAB_19f1_351c:
    mov     ax, offset aPen
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    sub     ax, ax
    push    ax                                 ; int
    push    word ptr [penalty_time]
    mov     ax, offset g_res_id
    push    ax                                 ; char *
    call    far ptr _strlen
    add     sp, 0x2
    add     ax, offset g_res_id
    push    ax                                 ; char *
    call    far ptr format_frame_as_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0x66
    jmp     near ptr LAB_19f1_32c5
LAB_19f1_356e:
    mov     ax, 0x71
    push    ax
    mov     ax, 0xe4
    push    ax
    push    word ptr [(sdgame2shapes+4*4)+2]   ; right arrow shape
    push    word ptr [(sdgame2shapes+4*4)]     ; right arrow shape
    call    far ptr sprite_putimage_transparent
    add     sp, 0x8
    mov     ax, offset rect_ingame_text
    push    ax
    mov     ax, offset rect_ingame_text4
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset aOpp_0
    jmp     near ptr LAB_19f1_34b7
LAB_19f1_35a0:
    cmp     byte ptr [game_replay_mode], 0x2
    jnz     LAB_19f1_361b
    mov     ax, word ptr [state.game_frame]
    sub     dx, dx
    div     word ptr [framespersec]
    mov     si, dx
    mov     ax, word ptr [framespersec]
    sar     ax, 0x1
    cmp     ax, si
    jle     LAB_19f1_361b
    mov     ax, offset aRpl_0
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_text_res
    add     sp, 0x6
    push    dx
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr copy_string
    add     sp, 0x6
    mov     ax, offset rect_ingame_text
    push    ax
    sub     ax, ax
    push    ax
    push    word ptr [dialog_fnt_colour]
    mov     ax, 0xf
    push    ax
    mov     ax, offset g_res_id
    push    ax                                 ; char *
    call    far ptr _strlen
    add     sp, 0x2
    mov     cl, 0x3
    shl     ax, cl
    sub     ax, 0x138
    neg     ax
LAB_19f1_3601:
    push    ax
    mov     ax, offset g_res_id
    push    ax
    call    far ptr intro_draw_text
    add     sp, 0xa
    push    ax
    mov     ax, offset rect_ingame_text
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
LAB_19f1_361b:
    mov     ax, offset rect_ingame_text
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
draw_ingame_text_asm_ endp

; RECTANGLE * __cdecl16far do_sinking(int frame, int top, int height)
do_sinking_asm_ proc far
    frame      = word ptr    6
    top        = word ptr    8
    height     = word ptr   10

    push    bp
    mov     bp, sp
    sub     sp, 0x2
    push    di
    push    si
    mov     di, word ptr [framespersec]
    mov     cl, 0x2
    shl     di, cl
    cmp     word ptr [bp+frame], di
    jle     LAB_19f1_363c
    mov     word ptr [bp+frame], di
LAB_19f1_363c:
    mov     ax, word ptr [framespersec]
    shl     ax, 0x1
    shl     ax, 0x1
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+frame]
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+height]
    cwd
    push    dx
    push    ax
    call    far ptr __aFlmul
    push    dx
    push    ax
    call    far ptr __aFldiv
    mov     si, ax
    mov     word ptr [rect_ingame_text], 0x0
    mov     word ptr [rect_ingame_text.rc_right], 0x140
    mov     di, word ptr [bp+top]
    add     di, word ptr [bp+height]
    mov     ax, di
    sub     ax, si
    mov     word ptr [rect_ingame_text.rc_top], ax
    mov     word ptr [rect_ingame_text.rc_bottom], di
    push    di
    push    ax
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    push    word ptr [skybox_wat_color]
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
    mov     ax, 0xaa0e
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
do_sinking_asm_ endp
    db 0x90

; RECTANGLE * __cdecl16far init_crak(int frame, int top, int height)
init_crak_asm_ proc far
    var_1A     = word ptr  -26
    var_18     = word ptr  -24
    var_14     = word ptr  -20
    var_12     = word ptr  -18
    var_10     = word ptr  -16
    var_E      = word ptr  -14
    var_C      = word ptr  -12
    var_A      = word ptr  -10
    var_cracshape = dword ptr  -8
    var_cinfshape = dword ptr  -4
    frame      = word ptr    6
    top        = word ptr    8
    height     = word ptr   10

    push    bp
    mov     bp, sp
    sub     sp, 0x1a
    push    di
    push    si
    mov     ax, offset aCrak
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_shape_alt
    add     sp, 0x6
    mov     word ptr [bp+var_cracshape], ax
    mov     word ptr [bp+var_cracshape+2], dx
    mov     ax, offset aCinf
    push    ax
    push    word ptr [gameresptr+2]
    push    word ptr [gameresptr]
    call    far ptr locate_shape_alt
    add     sp, 0x6
    mov     word ptr [bp+var_cinfshape], ax
    mov     word ptr [bp+var_cinfshape+2], dx
    mov     ax, word ptr [framespersec]
    cwd
    mov     cx, 0x7
    idiv    cx
    mov     cx, ax
    mov     ax, word ptr [bp+frame]
    cwd
    idiv    cx
    mov     word ptr [bp+var_1A], ax           ; var_1A = ax = (framespersec / 7) / framecount
    les     bx, [bp+var_cinfshape]
    mov     di, word ptr es:[bx]
    cmp     ax, di
    jl      LAB_19f1_3704
    lea     ax, [di-0x1]
    mov     word ptr [bp+var_1A], ax
LAB_19f1_3704:
    mov     di, word ptr [bp+var_1A]
    shl     di, 0x1
    les     bx, [bp+var_cinfshape]
    mov     ax, word ptr es:[bx+di+0x2]
    mov     word ptr [bp+var_18], ax
    push    si
    mov     di, offset rect_ingame_text
    mov     si, offset cliprect_unk
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     si
    sub     si, si
    jmp     near ptr LAB_19f1_3880
LAB_19f1_3726:
    mov     di, si
    mov     cl, 0x3
    shl     di, cl
    les     bx, [bp+var_cracshape]
    mov     ax, word ptr es:[bx+di]
    mov     dx, word ptr es:[bx+di+0x2]
    mov     word ptr [bp+var_10], ax
    mov     word ptr [bp+var_E], dx
    mov     bx, si
    shl     bx, cl
    mov     di, word ptr [bp+var_cracshape]
    mov     ax, word ptr es:[bx+di+0x4]
    mov     dx, word ptr es:[bx+di+0x6]
    mov     word ptr [bp+var_14], ax
    mov     word ptr [bp+var_12], dx
    mov     ax, 0xc8
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+height]
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+var_E]
    cwd
    push    dx
    push    ax
    call    far ptr __aFlmul
    push    dx
    push    ax
    call    far ptr __aFldiv
    mov     word ptr [bp+var_E], ax
    mov     ax, 0xc8
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+height]
    cwd
    push    dx
    push    ax
    mov     ax, word ptr [bp+var_12]
    cwd
    push    dx
    push    ax
    call    far ptr __aFlmul
    push    dx
    push    ax
    call    far ptr __aFldiv
    mov     word ptr [bp+var_12], ax
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_12]
    add     ax, word ptr [bp+top]
    dec     ax
    push    ax
    push    word ptr [bp+var_14]
    mov     ax, word ptr [bp+var_E]
    add     ax, word ptr [bp+top]
    dec     ax
    push    ax
    push    word ptr [bp+var_10]
    call    far ptr preRender_line
    add     sp, 0xa
    sub     ax, ax
    push    ax
    mov     ax, word ptr [bp+var_12]
    add     ax, word ptr [bp+top]
    inc     ax
    push    ax
    push    word ptr [bp+var_14]
    mov     ax, word ptr [bp+var_E]
    add     ax, word ptr [bp+top]
    inc     ax
    push    ax
    push    word ptr [bp+var_10]
    call    far ptr preRender_line
    add     sp, 0xa
    push    word ptr [dialog_fnt_colour]
    mov     ax, word ptr [bp+var_12]
    add     ax, word ptr [bp+top]
    push    ax
    push    word ptr [bp+var_14]
    mov     ax, word ptr [bp+var_E]
    add     ax, word ptr [bp+top]
    push    ax
    push    word ptr [bp+var_10]
    call    far ptr preRender_line
    add     sp, 0xa
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_37ff
    jmp     near ptr LAB_19f1_387f
LAB_19f1_37ff:
    mov     ax, word ptr [bp+var_10]
    mov     word ptr [bp+var_C], ax
    mov     ax, word ptr [bp+var_E]
    add     ax, word ptr [bp+top]
    dec     ax
    mov     word ptr [bp+var_A], ax
    mov     ax, offset rect_ingame_text
    push    ax
    lea     ax, [bp+var_C]
    push    ax
    call    far ptr rect_adjust_from_point
    add     sp, 0x4
    mov     ax, word ptr [bp+var_14]
    mov     word ptr [bp+var_C], ax
    mov     ax, word ptr [bp+var_12]
    add     ax, word ptr [bp+top]
    inc     ax
    mov     word ptr [bp+var_A], ax
    mov     ax, offset rect_ingame_text
    push    ax
    lea     ax, [bp+var_C]
    push    ax
    call    far ptr rect_adjust_from_point
    add     sp, 0x4
    mov     ax, word ptr [bp+var_10]
    mov     word ptr [bp+var_C], ax
    mov     ax, word ptr [bp+var_E]
    add     ax, word ptr [bp+top]
    inc     ax
    mov     word ptr [bp+var_A], ax
    mov     ax, offset rect_ingame_text
    push    ax
    lea     ax, [bp+var_C]
    push    ax
    call    far ptr rect_adjust_from_point
    add     sp, 0x4
    mov     ax, word ptr [bp+var_14]
    mov     word ptr [bp+var_C], ax
    mov     ax, word ptr [bp+var_12]
    add     ax, word ptr [bp+top]
    dec     ax
    mov     word ptr [bp+var_A], ax
    mov     ax, offset rect_ingame_text
    push    ax
    lea     ax, [bp+var_C]
    push    ax
    call    far ptr rect_adjust_from_point
    add     sp, 0x4
LAB_19f1_387f:
    inc     si
LAB_19f1_3880:
    cmp     word ptr [bp+var_18], si
    jle     LAB_19f1_3888
    jmp     near ptr LAB_19f1_3726
LAB_19f1_3888:
    mov     ax, offset rect_ingame_text
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
init_crak_asm_ endp
    db 0x90

; void __cdecl16far load_skybox(byte unk)
load_skybox_asm_ proc far
    var_4      = word ptr   -4
    unk        = byte ptr    6

    push    bp
    mov     bp, sp
    sub     sp, 0x4
    push    si
    test    byte ptr [bp+unk], 0x8
    jz      LAB_19f1_38a6
    and     byte ptr [bp+unk], 0x7
    jmp     near ptr LAB_19f1_397e
LAB_19f1_38a6:
    cmp     byte ptr [byte_3B8F6], 0x0
    jz      LAB_19f1_38b8
    mov     al, byte ptr [byte_46167]
    cmp     byte ptr [bp+unk], al
    jnz     LAB_19f1_38b8
    jmp     near ptr LAB_19f1_399f
LAB_19f1_38b8:
    push    cs
    call    near ptr unload_skybox
    mov     al, byte ptr [bp+unk]
    mov     byte ptr [byte_46167], al
    mov     byte ptr [byte_3B8F6], 0x1
    cbw
    mov     cx, ax
    shl     ax, 0x1
    shl     ax, 0x1
    shl     ax, 0x1
    add     ax, cx
    add     ax, offset g_sceneries
    push    ax
    call    far ptr file_load_shape2d_fatal_thunk
    add     sp, 0x2
    mov     word ptr [skybox_res_ofs], ax
    mov     word ptr [skybox_res_seg], dx
    mov     ax, offset skyboxes
    push    ax
    mov     ax, offset aScensce2sce3sce4
    push    ax
    push    dx
    push    word ptr [skybox_res_ofs]
    call    far ptr locate_many_resources
    add     sp, 0x8
    les     bx, [skyboxes]
    mov     ax, word ptr es:[bx+0x2]
    mov     word ptr [skybox_ptr1], ax
    les     bx, [(skyboxes+1*4)]
    mov     ax, word ptr es:[bx+0x2]
    mov     word ptr [skybox_ptr2], ax
    les     bx, [(skyboxes+2*4)]
    mov     ax, word ptr es:[bx+0x2]
    mov     word ptr [skybox_ptr3], ax
    les     bx, [(skyboxes+3*4)]
    mov     ax, word ptr es:[bx+0x2]
    mov     word ptr [skybox_ptr4], ax
    mov     si, word ptr [skybox_ptr1]
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr2]
    jbe     LAB_19f1_3936
    mov     si, word ptr [skybox_ptr2]
LAB_19f1_3936:
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr3]
    jbe     LAB_19f1_3942
    mov     si, word ptr [skybox_ptr3]
LAB_19f1_3942:
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr4]
    jbe     LAB_19f1_394e
    mov     si, word ptr [skybox_ptr4]
LAB_19f1_394e:
    mov     word ptr [skybox_current], si
    mov     si, word ptr [skybox_ptr1]
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr2]
    jnc     LAB_19f1_3962
    mov     si, word ptr [skybox_ptr2]
LAB_19f1_3962:
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr3]
    jnc     LAB_19f1_396e
    mov     si, word ptr [skybox_ptr3]
LAB_19f1_396e:
    mov     ax, si
    cmp     ax, word ptr [skybox_ptr4]
    jnc     LAB_19f1_397a
    mov     si, word ptr [skybox_ptr4]
LAB_19f1_397a:
    mov     word ptr [word_454CE], si
LAB_19f1_397e:
    mov     ax, word ptr [material_clrlist_ptr]
    mov     word ptr [bp+var_4], ax
    mov     bx, ax
    mov     ax, word ptr [bx+0x22]
    mov     word ptr [skybox_sky_color], ax
    mov     ax, word ptr [bx+0x20]
    mov     word ptr [skybox_grd_color], ax
    mov     ax, word ptr [bx+0xc8]
    mov     word ptr [skybox_wat_color], ax
    mov     ax, word ptr [dialog_fnt_colour]
    mov     word ptr [meter_needle_color], ax
LAB_19f1_399f:
    pop     si
    mov     sp, bp
    pop     bp
    retf
load_skybox_asm_ endp

; void __cdecl16far unload_skybox(void)
unload_skybox_asm_ proc far
    cmp     byte ptr [byte_3B8F6], 0x0
    jz      LAB_19f1_39bb
    push    word ptr [skybox_res_seg]
    push    word ptr [skybox_res_ofs]
    call    far ptr mmgr_free
    add     sp, 0x4
LAB_19f1_39bb:
    mov     byte ptr [byte_3B8F6], 0x0
    retf
unload_skybox_asm_ endp
    db 0x90

; void __cdecl16far load_sdgame2_shapes(void)
load_sdgame2_shapes_asm_ proc far
    push    bp
    mov     bp, sp
    sub     sp, 0x2
    push    di
    push    si
    mov     ax, offset aSdgame2
    push    ax                                 ; char *
    mov     ax, 0x8
    push    ax                                 ; int
    call    far ptr file_load_resource
    add     sp, 0x4
    mov     word ptr [sdgame2ptr], ax
    mov     word ptr [sdgame2ptr+2], dx
    mov     ax, offset sdgame2shapes
    push    ax
    mov     ax, offset aEx01ex02ex03leftrigh
    push    ax
    push    dx
    push    word ptr [sdgame2ptr]
    call    far ptr locate_many_resources
    add     sp, 0x8
    sub     si, si
LAB_19f1_39f8:
    mov     bx, si
    shl     bx, 0x1
    mov     di, si
    shl     di, 0x1
    shl     di, 0x1
    les     di, [di+sdgame2shapes]
    mov     ax, word ptr es:[di]
    mov     word ptr [bx+sdgame2_widths], ax
    inc     si
    cmp     si, 0x3
    jl      LAB_19f1_39f8
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
load_sdgame2_shapes_asm_ endp
    db 0x90

; void __cdecl16far free_sdgame2(void)
free_sdgame2_asm_ proc far
    push    word ptr [sdgame2ptr+2]
    push    word ptr [sdgame2ptr]
    call    far ptr mmgr_free
    add     sp, 0x4
    retf
free_sdgame2_asm_ endp
    db 0x90

; int __cdecl16far setup_intro(void)
setup_intro_asm_ proc far
    var_5D4    = word ptr  -1492
    var_5D2    = word ptr  -1490
    var_5D0    = byte ptr  -1488
    var_440    = word ptr  -1088
    var_43E    = byte ptr  -1086
    var_title3dres_seg = word ptr  -686
    var_title3dres_ofs = word ptr  -684
    var_2AA    = word ptr  -682
    var_2A8    = word ptr  -680
    var_2A6    = word ptr  -678
    var_2A4    = word ptr  -676
    var_2A2    = byte ptr  -674
    var_2A0    = word ptr  -672
    var_29E    = word ptr  -670
    var_29C    = word ptr  -668
    var_29A    = word ptr  -666
    var_298    = word ptr  -664
    var_296    = word ptr  -662
    var_42     = word ptr  -66
    var_40     = word ptr  -64
    var_3E     = word ptr  -62
    var_3C     = word ptr  -60
    var_3A     = word ptr  -58
    var_38     = byte ptr  -56
    var_rectindex = word ptr  -54
    var_rect   = byte ptr  -52
    var_2C     = word ptr  -44
    var_rect2  = byte ptr  -42
    var_22     = word ptr  -34
    var_20     = word ptr  -32
    var_1E     = word ptr  -30
    var_1C     = word ptr  -28
    var_1A     = word ptr  -26
    var_18     = word ptr  -24
    var_rect3  = byte ptr  -22
    var_E      = word ptr  -14
    var_C      = word ptr  -12
    var_A      = word ptr  -10
    var_8      = word ptr   -8
    var_6      = word ptr   -6
    var_4      = word ptr   -4
    var_2      = word ptr   -2

    push    bp
    mov     bp, sp
    sub     sp, 0x5d4
    push    di
    push    si
    mov     byte ptr [bp+var_38], 0x0
    mov     ax, offset aTitle
    push    ax
    call    far ptr file_load_3dres
    add     sp, 0x2
    mov     word ptr [bp+var_title3dres_seg], ax
    mov     word ptr [bp+var_title3dres_ofs], dx
    lea     ax, [bp+var_22]
    push    ax
    mov     ax, offset aLogolog2brav
    push    ax
    push    dx
    push    word ptr [bp+var_title3dres_seg]
    call    far ptr locate_many_resources
    add     sp, 0x8
    mov     ax, offset logoshape
    push    ax
    push    word ptr [bp+var_20]
    push    word ptr [bp+var_22]
    call    far ptr shape3d_init_shape
    add     sp, 0x6
    mov     ax, offset logo2shape
    push    ax
    push    word ptr [bp+var_1C]
    push    word ptr [bp+var_1E]
    call    far ptr shape3d_init_shape
    add     sp, 0x6
    mov     ax, offset bravshape
    push    ax
    push    word ptr [bp+var_18]
    push    word ptr [bp+var_1A]
    call    far ptr shape3d_init_shape
    add     sp, 0x6
    cmp     byte ptr [video_flag5_is0], 0x0
    jnz     LAB_19f1_3aba
    mov     ax, 0xf
    push    ax
    mov     ax, 0xc8
    push    ax
    mov     ax, 0x140
    push    ax
    call    far ptr sprite_make_wnd
    add     sp, 0x6
    mov     word ptr [wndsprite], ax
    mov     word ptr [wndsprite+2], dx
LAB_19f1_3aba:
    mov     word ptr [bp+var_42], 0x0
LAB_19f1_3abf:
    call    far ptr get_kevinrandom
    mov     cl, 0x7
    shl     ax, cl
    sub     ax, 0x4000
    mov     si, word ptr [bp+var_42]
    mov     cx, si
    shl     si, 0x1
    add     si, cx
    shl     si, 0x1
    mov     word ptr [bp+si+0xfd66], ax
    call    far ptr get_kevinrandom
    mov     cl, 0x7
    shl     ax, cl
    sub     ax, 0x1388
    neg     ax
    mov     si, word ptr [bp+var_42]
    mov     cx, si
    shl     si, 0x1
    add     si, cx
    shl     si, 0x1
    mov     word ptr [bp+si+0xfd68], ax
    call    far ptr get_kevinrandom
    mov     cl, 0x7
    shl     ax, cl
    sub     ax, 0x4000
    mov     si, word ptr [bp+var_42]
    mov     cx, si
    shl     si, 0x1
    add     si, cx
    shl     si, 0x1
    mov     word ptr [bp+si+0xfd6a], ax
    inc     word ptr [bp+var_42]
    cmp     word ptr [bp+var_42], 0x64
    jl      LAB_19f1_3abf
    mov     ax, 0xc8
    push    ax
    mov     ax, 0x140
    push    ax
    mov     ax, 0x28
    push    ax
    push    ax
    call    far ptr set_projection
    add     sp, 0x8
    mov     word ptr [bp+var_3E], 0x400
    mov     word ptr [bp+var_3A], 0x400
    mov     word ptr [bp+var_3C], 0x12c
    mov     word ptr [bp+var_E], 0x0
    mov     word ptr [bp+var_5D4], 0x0
    mov     ax, offset aCarcoun_0
    push    ax
    call    far ptr file_load_resfile
    add     sp, 0x2
    mov     word ptr [bp+var_A], ax
    mov     word ptr [bp+var_8], dx
    mov     ax, 0x1
    push    ax
    push    dx
    push    word ptr [bp+var_A]
    call    far ptr setup_aero_trackdata
    add     sp, 0x6
    push    word ptr [bp+var_8]
    push    word ptr [bp+var_A]
    call    far ptr unload_resource
    add     sp, 0x4
    call    far ptr init_plantrak
    call    far ptr timer_get_delta
    mov     word ptr [bp+var_2AA], 0x0
    mov     word ptr [bp+var_440], 0x0
    mov     ax, word ptr [slow_video_mgmt]
    mov     word ptr [slow_video_mgmt_copy], ax
    mov     word ptr [rect_unk], 0x0
    mov     word ptr [rect_unk.rc_right], 0x140
    mov     word ptr [rect_unk.rc_top], 0x0
    mov     word ptr [rect_unk.rc_bottom], 0xc8
    mov     di, offset rect_unk2
    mov     si, offset rect_unk
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    mov     di, offset rect_unk3
    mov     si, offset rect_unk
    movsw
    movsw
    movsw
    movsw
    mov     word ptr [bp+var_rectindex], 0x0
    mov     byte ptr [bp+var_2A2], 0x1
LAB_19f1_3bce:
    call    far ptr timer_get_delta
    mov     word ptr [bp+var_40], ax
    add     word ptr [word_44DCC], ax
    jmp     near ptr LAB_19f1_3c7a
    db 0x90
LAB_19f1_3bde:
    mov     ax, word ptr [word_4499C]
    sub     word ptr [word_44DCC], ax
    call    far ptr do_opponent_op
    mov     byte ptr [bp+var_2A2], 0x1
    mov     ax, word ptr [framespersec]
    mov     cx, ax
    shl     ax, 0x1
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    inc     word ptr [bp+var_5D4]
    cmp     ax, word ptr [bp+var_5D4]
    jge     LAB_19f1_3c7a
    mov     word ptr [bp+var_E], 0x1
    add     word ptr [bp+var_3C], 0x14
    sub     word ptr [bp+var_3A], 0x5
    mov     ax, word ptr [bp+var_3E]
    sub     ax, 0x400
    mov     word ptr [bp+var_42], ax
    or      ax, ax
    jge     LAB_19f1_3c28
    neg     ax
    jmp     LAB_19f1_3c2b
    db 0x90
    db 0x90
LAB_19f1_3c28:
    mov     ax, word ptr [bp+var_42]
LAB_19f1_3c2b:
    cmp     ax, 0xa
    jge     LAB_19f1_3c38
    mov     word ptr [bp+var_3E], 0x400
    jmp     LAB_19f1_3c4e
    db 0x90
LAB_19f1_3c38:
    cmp     word ptr [bp+var_42], 0x0
    jle     LAB_19f1_3c44
    sub     word ptr [bp+var_3E], 0xa
    jmp     LAB_19f1_3c4e
LAB_19f1_3c44:
    cmp     word ptr [bp+var_42], 0x0
    jge     LAB_19f1_3c4e
    add     word ptr [bp+var_3E], 0xa
LAB_19f1_3c4e:
    cmp     word ptr [bp+var_6], 0x400
    jle     LAB_19f1_3c5a
    dec     word ptr [bp+var_6]
    jmp     LAB_19f1_3c64
LAB_19f1_3c5a:
    cmp     word ptr [bp+var_6], 0x400
    jge     LAB_19f1_3c64
    inc     word ptr [bp+var_6]
LAB_19f1_3c64:
    cmp     word ptr [bp+var_2], 0x400
    jle     LAB_19f1_3c70
    dec     word ptr [bp+var_2]
    jmp     LAB_19f1_3c7a
LAB_19f1_3c70:
    cmp     word ptr [bp+var_2], 0x400
    jge     LAB_19f1_3c7a
    inc     word ptr [bp+var_2]
LAB_19f1_3c7a:
    mov     ax, word ptr [word_4499C]
    cmp     word ptr [word_44DCC], ax
    jle     LAB_19f1_3c86
    jmp     near ptr LAB_19f1_3bde
LAB_19f1_3c86:
    cmp     byte ptr [bp+var_2A2], 0x0
    jnz     LAB_19f1_3c90
    jmp     near ptr LAB_19f1_3f09
LAB_19f1_3c90:
    mov     byte ptr [bp+var_2A2], 0x0
    cmp     byte ptr [video_flag5_is0], 0x0
    jz      LAB_19f1_3ca4
    call    far ptr setup_mcgawnd2
    jmp     LAB_19f1_3ca9
    db 0x90
LAB_19f1_3ca4:
    call    far ptr sprite_copy_wnd_to_1
LAB_19f1_3ca9:
    mov     word ptr [bp+var_2C], 0xffff
    mov     word ptr [bp+var_2A6], 0x1
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_3cbd:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_3cbd
    mov     word ptr [bp+var_2A0], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.ly]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_3cd2:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_3cd2
    mov     word ptr [bp+var_29E], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_3ce7:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_3ce7
    mov     word ptr [bp+var_29C], ax
    mov     ax, word ptr [framespersec]
    mov     cx, ax
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    cmp     ax, word ptr [bp+var_5D4]
    jle     LAB_19f1_3d34
    mov     word ptr [bp+var_2A6], 0x0
    mov     ax, word ptr [state.opponentstate.car_rotate.vx]
    and     ah, 0x3
    mov     word ptr [bp+var_2C], ax
    mov     word ptr [bp+var_2A4], 0x0
    mov     ax, word ptr [bp+var_2A0]
    mov     word ptr [bp+var_3E], ax
    mov     ax, word ptr [bp+var_29E]
    add     ax, 0x14
    mov     word ptr [bp+var_3C], ax
    mov     ax, word ptr [bp+var_29C]
    mov     word ptr [bp+var_3A], ax
    jmp     LAB_19f1_3d6d
    db 0x90
LAB_19f1_3d34:
    mov     ax, word ptr [framespersec]
    mov     cx, ax
    shl     ax, 0x1
    shl     ax, 0x1
    add     ax, cx
    shl     ax, 0x1
    add     ax, cx
    cmp     ax, word ptr [bp+var_5D4]
    jle     LAB_19f1_3d6d
    mov     word ptr [bp+var_3E], 0x400
    mov     word ptr [bp+var_3A], 0x400
    mov     word ptr [bp+var_3C], 0x5a
    mov     ax, word ptr [bp+var_2A0]
    mov     word ptr [bp+var_6], ax
    mov     ax, word ptr [bp+var_29E]
    mov     word ptr [bp+var_4], ax
    mov     ax, word ptr [bp+var_29C]
    mov     word ptr [bp+var_2], ax
LAB_19f1_3d6d:
    cmp     word ptr [bp+var_2C], -0x1
    jnz     LAB_19f1_3dc1
    mov     ax, word ptr [bp+var_2]
    sub     ax, word ptr [bp+var_3A]
    push    ax
    mov     ax, word ptr [bp+var_6]
    sub     ax, word ptr [bp+var_3E]
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    neg     ax
    and     ah, 0x3
    mov     word ptr [bp+var_2C], ax
    mov     ax, word ptr [bp+var_2]
    sub     ax, word ptr [bp+var_3A]
    push    ax
    mov     ax, word ptr [bp+var_6]
    sub     ax, word ptr [bp+var_3E]
    push    ax
    call    far ptr int_hypot
    add     sp, 0x4
    mov     word ptr [bp+var_C], ax
    push    ax
    mov     ax, word ptr [bp+var_4]
    sub     ax, word ptr [bp+var_3C]
    push    ax
    call    far ptr int_atan2
    add     sp, 0x4
    and     ah, 0x3
    mov     word ptr [bp+var_2A4], ax
LAB_19f1_3dc1:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_3dec
    cmp     word ptr [bp+var_rectindex], 0x0
    jnz     LAB_19f1_3ddc
    lea     ax, [bp+var_43E]
    mov     word ptr [bp+var_2A8], ax
    lea     ax, [bp+var_2AA]
    jmp     LAB_19f1_3de8
LAB_19f1_3ddc:
    lea     ax, [bp+var_5D0]
    mov     word ptr [bp+var_2A8], ax
    lea     ax, [bp+var_440]
LAB_19f1_3de8:
    mov     word ptr [bp+var_5D2], ax
LAB_19f1_3dec:
    lea     ax, [bp+var_rect]
    push    ax
    lea     ax, [bp+var_rect3]
    push    ax
    mov     bx, word ptr [bp+var_rectindex]
    mov     cl, 0x3
    shl     bx, cl
    push    word ptr [bx+rect_unk.rc_bottom]
    push    word ptr [bx+rect_unk.rc_top]
    push    word ptr [bx+rect_unk.rc_right]
    push    word ptr [bx+rect_unk]
    push    word ptr [bp+var_5D2]
    push    word ptr [bp+var_2A8]
    lea     ax, [bp+var_29A]
    push    ax
    push    word ptr [bp+var_E]
    push    word ptr [bp+var_2A6]
    push    word ptr [bp+var_2A4]
    push    word ptr [bp+var_2C]
    push    word ptr [bp+var_3A]
    push    word ptr [bp+var_3C]
    push    word ptr [bp+var_3E]
    push    cs
    call    near ptr intro_op
    add     sp, 0x20
    cmp     byte ptr [video_flag5_is0], 0x0
    jz      LAB_19f1_3e6e
    call    far ptr mouse_draw_opaque_check
    call    far ptr setup_mcgawnd1
    call    far ptr mouse_draw_transparent_check
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_3e67
    mov     bx, word ptr [bp+var_rectindex]
    mov     cl, 0x3
    shl     bx, cl
    lea     di, [bx+rect_unk]
    lea     si, [bp+var_rect3]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
LAB_19f1_3e67:
    xor     byte ptr [bp+var_rectindex], 0x1
    jmp     near ptr LAB_19f1_3f09
LAB_19f1_3e6e:
    call    far ptr sprite_copy_2_to_1_2
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_3eec
    lea     ax, [bp+var_rect2]
    push    ax
    mov     ax, offset rect_unk6
    push    ax
    lea     ax, [bp+var_rect]
    push    ax
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset rect_unk3
    push    ax
    lea     ax, [bp+var_rect2]
    push    ax
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jnz     LAB_19f1_3f09
    push    word ptr [bp+var_rect2+6]
    push    word ptr [bp+var_rect2+4]
    push    word ptr [bp+var_rect2+2]
    push    word ptr [bp+var_rect2]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    call    far ptr mouse_draw_opaque_check
    les     bx, [wndsprite]
    push    word ptr es:[bx+0x2]
    push    word ptr es:[bx]
    call    far ptr sprite_putimage
    add     sp, 0x4
    call    far ptr mouse_draw_transparent_check
    mov     di, offset rect_unk
    lea     si, [bp+var_rect3]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    mov     di, offset rect_unk6
    lea     si, [bp+var_rect]
    movsw
    movsw
    movsw
    movsw
    jmp     LAB_19f1_3f09
    db 0x90
LAB_19f1_3eec:
    call    far ptr mouse_draw_opaque_check
    les     bx, [wndsprite]
    push    word ptr es:[bx+0x2]
    push    word ptr es:[bx]
    call    far ptr sprite_putimage
    add     sp, 0x4
    call    far ptr mouse_draw_transparent_check
LAB_19f1_3f09:
    push    word ptr [bp+var_40]
    call    far ptr input_do_checking
    add     sp, 0x2
    or      ax, ax
    jz      LAB_19f1_3f1e
    mov     byte ptr [bp+var_38], 0x1
    jmp     LAB_19f1_3f2e
LAB_19f1_3f1e:
    mov     ax, 0x17
    imul    word ptr [framespersec]
    cmp     ax, word ptr [bp+var_5D4]
    jle     LAB_19f1_3f2e
    jmp     near ptr LAB_19f1_3bce
LAB_19f1_3f2e:
    cmp     byte ptr [video_flag5_is0], 0x0
    jz      LAB_19f1_3f6c
    call    far ptr get_0
    or      ax, ax
    jz      LAB_19f1_3f7c
    call    far ptr setup_mcgawnd2
    sub     ax, ax
    push    ax
    mov     ax, 0xc8
    push    ax
    mov     ax, 0x140
    push    ax
    sub     ax, ax
    push    ax
    push    ax
    call    far ptr sub_35C4E
    add     sp, 0xa
    call    far ptr mouse_draw_opaque_check
    call    far ptr setup_mcgawnd1
    call    far ptr mouse_draw_transparent_check
    jmp     LAB_19f1_3f7c
    db 0x90
LAB_19f1_3f6c:
    push    word ptr [wndsprite+2]
    push    word ptr [wndsprite]
    call    far ptr sprite_free_wnd
    add     sp, 0x4
LAB_19f1_3f7c:
    push    word ptr [bp+var_title3dres_ofs]
    push    word ptr [bp+var_title3dres_seg]
    call    far ptr mmgr_free
    add     sp, 0x4
    mov     al, byte ptr [bp+var_38]
    cbw
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
setup_intro_asm_ endp

; void __cdecl16far intro_op(int unk_x, int unk_y, int unk_z, int unk_ang_y, int unk_ang_x, int param_6, int param_7, int param_8, int param_9, int * param_10, RECTANGLE * rect1, RECTANGLE * rect2, RECTANGLE * rect3)
intro_op_asm_ proc far
    var_42     = word ptr  -66
    var_vec    = byte ptr  -64
    var_point  = dword ptr -58
    var_vec2   = word ptr  -54
    var_34     = word ptr  -52
    var_32     = word ptr  -50
    var_rect1  = byte ptr  -44
    var_rect2  = byte ptr  -36
    var_transshape = byte ptr  -28
    var_rect3  = byte ptr   -8
    unk_x      = word ptr    6
    unk_y      = word ptr    8
    unk_z      = word ptr   10
    unk_ang_y  = word ptr   12
    unk_ang_x  = word ptr   14
    param_6    = word ptr   16
    param_7    = word ptr   18
    param_8    = word ptr   20
    param_9    = word ptr   22
    param_10   = word ptr   24
    rect1      = word ptr   26
    rect2      = word ptr   28
    rect3      = word ptr   30

    push    bp
    mov     bp, sp
    sub     sp, 0x42
    push    di
    push    si
    push    si
    push    di
    lea     di, [bp+var_rect3]
    mov     si, offset cliprect_unk
    push    ss
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    sub     ax, ax
    push    ax
    mov     ax, offset intro_cliprect
    push    ax
    push    word ptr [bp+unk_ang_y]
    push    word ptr [bp+unk_ang_x]
    sub     ax, ax
    push    ax
    call    far ptr select_cliprect_rotate
    add     sp, 0xa
    cmp     word ptr [bp+param_7], 0x0
    jz      LAB_19f1_3fd4
    mov     word ptr [bp+var_transshape+6], offset logoshape
    jmp     LAB_19f1_3fd9
    db 0x90
LAB_19f1_3fd4:
    mov     word ptr [bp+var_transshape+6], offset logo2shape
LAB_19f1_3fd9:
    mov     ax, 0x400
    sub     ax, word ptr [bp+unk_x]
    mov     word ptr [bp+var_transshape], ax
    mov     ax, word ptr [bp+unk_y]
    neg     ax
    mov     word ptr [bp+var_transshape+2], ax
    mov     ax, 0x400
    sub     ax, word ptr [bp+unk_z]
    mov     word ptr [bp+var_transshape+4], ax
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_4006
    lea     ax, [bp+var_rect3]
    mov     word ptr [bp+var_transshape+8], ax
    mov     byte ptr [bp+var_transshape+18], 0xc
    jmp     LAB_19f1_400a
LAB_19f1_4006:
    mov     byte ptr [bp+var_transshape+18], 0x4
LAB_19f1_400a:
    mov     word ptr [bp+var_transshape+10], 0x0
    mov     word ptr [bp+var_transshape+12], 0x0
    mov     word ptr [bp+var_transshape+14], 0x0
    mov     word ptr [bp+var_transshape+16], 0x400
    mov     byte ptr [bp+var_transshape+19], 0x0
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
    cmp     word ptr [bp+param_6], 0x0
    jnz     LAB_19f1_4037
    jmp     near ptr LAB_19f1_40bf
LAB_19f1_4037:
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lx]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lx+2]
    mov     cl, 0x6
LAB_19f1_4040:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_4040
    sub     ax, word ptr [bp+unk_x]
    mov     word ptr [bp+var_transshape], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.ly]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.ly+2]
    mov     cl, 0x6
LAB_19f1_4057:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_4057
    sub     ax, word ptr [bp+unk_y]
    mov     word ptr [bp+var_transshape+2], ax
    mov     ax, word ptr [state.opponentstate.car_posWorld1.lz]
    mov     dx, word ptr [state.opponentstate.car_posWorld1.lz+2]
    mov     cl, 0x6
LAB_19f1_406e:
    sar     dx, 0x1
    rcr     ax, 0x1
    dec     cl
    jnz     LAB_19f1_406e
    sub     ax, word ptr [bp+unk_z]
    mov     word ptr [bp+var_transshape+4], ax
    mov     word ptr [bp+var_transshape+6], offset bravshape
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_4094
    lea     ax, [bp+var_rect3]
    mov     word ptr [bp+var_transshape+8], ax
    mov     byte ptr [bp+var_transshape+18], 0xc
    jmp     LAB_19f1_4098
LAB_19f1_4094:
    mov     byte ptr [bp+var_transshape+18], 0x4
LAB_19f1_4098:
    mov     word ptr [bp+var_transshape+10], 0x0
    mov     word ptr [bp+var_transshape+12], 0x0
    mov     ax, word ptr [state.opponentstate.car_rotate.vx]
    neg     ax
    mov     word ptr [bp+var_transshape+14], ax
    mov     word ptr [bp+var_transshape+16], 0x400
    mov     byte ptr [bp+var_transshape+19], 0x0
    lea     ax, [bp+var_transshape]
    push    ax
    call    far ptr transformed_shape_op
    add     sp, 0x2
LAB_19f1_40bf:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jnz     LAB_19f1_40c9
    jmp     near ptr LAB_19f1_415c
LAB_19f1_40c9:
    mov     bx, word ptr [bp+param_10]
    cmp     word ptr [bx], 0x0
    jz      LAB_19f1_4103
    sub     si, si
    jmp     LAB_19f1_40fc
    db 0x90
LAB_19f1_40d6:
    mov     bx, word ptr [bp+param_9]
    mov     ax, si
    shl     ax, 0x1
    shl     ax, 0x1
    add     bx, ax
    mov     ax, word ptr [bx]
    mov     dx, word ptr [bx+0x2]
    mov     word ptr [bp+var_point], ax
    mov     word ptr [bp+var_point+2], dx
    sub     ax, ax
    push    ax
    push    dx
    push    word ptr [bp+var_point]
    call    far ptr putpixel_single_maybe
    add     sp, 0x6
    inc     si
LAB_19f1_40fc:
    mov     bx, word ptr [bp+param_10]
    cmp     word ptr [bx], si
    jg      LAB_19f1_40d6
LAB_19f1_4103:
    lea     ax, [bp+var_rect1]
    push    ax
    lea     ax, [bp+rect1]
    push    ax
    push    word ptr [bp+0x22]
    call    far ptr rect_union
    add     sp, 0x6
    mov     ax, offset rect_unk3
    push    ax
    lea     ax, [bp+var_rect1]
    push    ax
    call    far ptr rect_intersect
    add     sp, 0x4
    or      al, al
    jnz     LAB_19f1_4149
    push    word ptr [bp+var_rect1+6]
    push    word ptr [bp+var_rect1+4]
    push    word ptr [bp+var_rect1+2]
    push    word ptr [bp+var_rect1]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    sub     ax, ax
    push    ax
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_4149:
    push    si
    push    di
    lea     di, [bp+var_rect2]
    lea     si, [bp+var_rect3]
    push    ss
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    jmp     LAB_19f1_417f
    db 0x90
LAB_19f1_415c:
    push    word ptr [intro_cliprect.rc_bottom]
    push    word ptr [intro_cliprect.rc_top]
    push    word ptr [intro_cliprect.rc_right]
    push    word ptr [intro_cliprect]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    sub     ax, ax
    push    ax
    call    far ptr sprite_clear_1_color
    add     sp, 0x2
LAB_19f1_417f:
    push    word ptr [intro_cliprect.rc_bottom]
    push    word ptr [intro_cliprect.rc_top]
    push    word ptr [intro_cliprect.rc_right]
    push    word ptr [intro_cliprect]
    call    far ptr sprite_set_1_size
    add     sp, 0x8
    sub     di, di
    sub     si, si
LAB_19f1_419b:
    mov     ax, word ptr [bp+param_8]
    mov     cx, si
    mov     dx, cx
    shl     cx, 0x1
    add     cx, dx
    shl     cx, 0x1
    add     ax, cx
    mov     word ptr [bp+var_42], ax
    mov     bx, ax
    mov     ax, word ptr [bx]
    sub     ax, word ptr [bp+unk_x]
    mov     word ptr [bp+var_vec2], ax
    mov     ax, word ptr [bx+0x2]
    sub     ax, word ptr [bp+unk_y]
    mov     word ptr [bp+var_34], ax
    mov     ax, word ptr [bx+0x4]
    sub     ax, word ptr [bp+unk_z]
    mov     word ptr [bp+var_32], ax
    lea     ax, [bp+var_vec]
    push    ax
    mov     ax, offset mat_temp
    push    ax
    lea     ax, [bp+var_vec2]
    push    ax
    call    far ptr mat_mul_vector
    add     sp, 0x6
    cmp     word ptr [bp+var_vec+4], 0xc8
    jle     LAB_19f1_4247
    lea     ax, [bp+var_point]
    push    ax
    lea     ax, [bp+var_vec]
    push    ax
    call    far ptr vector_to_point
    add     sp, 0x4
    push    word ptr [intro_colorvalue]
    push    word ptr [bp+var_point+2]
    push    word ptr [bp+var_point]
    call    far ptr putpixel_single_maybe
    add     sp, 0x6
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_4234
    mov     bx, word ptr [bp+param_9]
    mov     ax, di
    inc     di
    shl     ax, 0x1
    shl     ax, 0x1
    add     bx, ax
    mov     ax, word ptr [bp+var_point]
    mov     dx, word ptr [bp+var_point+2]
    mov     word ptr [bx], ax
    mov     word ptr [bx+0x2], dx
    lea     ax, [bp+var_rect2]
    push    ax
    lea     ax, [bp+var_point]
    push    ax
    call    far ptr rect_adjust_from_point
    add     sp, 0x4
LAB_19f1_4234:
    inc     word ptr [intro_colorvalue]
    mov     ax, word ptr [word_407CC]
    cmp     word ptr [intro_colorvalue], ax
    jnz     LAB_19f1_4247
    mov     word ptr [intro_colorvalue], 0x1
LAB_19f1_4247:
    inc     si
    cmp     si, 0x64
    jge     LAB_19f1_4250
    jmp     near ptr LAB_19f1_419b
LAB_19f1_4250:
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_425c
    mov     bx, word ptr [bp+param_10]
    mov     word ptr [bx], di
LAB_19f1_425c:
    call    far ptr get_a_poly_info
    cmp     word ptr [slow_video_mgmt_copy], 0x0
    jz      LAB_19f1_428a
    mov     bx, word ptr [bp+0x22]
    push    si
    push    di
    mov     di, bx
    lea     si, [bp+var_rect3]
    push    ds
    pop     es
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
    mov     bx, word ptr [bp+0x24]
    push    si
    push    di
    mov     di, bx
    lea     si, [bp+var_rect2]
    movsw
    movsw
    movsw
    movsw
    pop     di
    pop     si
LAB_19f1_428a:
    pop     si
    pop     di
    mov     sp, bp
    pop     bp
    retf
intro_op_asm_ endp

seg003 ends
end
